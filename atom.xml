<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>개인 저장소</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-03-04T04:21:01.016Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Ming</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>VSCode로 Spring Boot 사용시 profile설정</title>
    <link href="http://yoursite.com/2020/03/04/VSCode%EB%A1%9C%20Spring%20Boot%20%EC%82%AC%EC%9A%A9%EC%8B%9C%20profile%EC%84%A4%EC%A0%95/"/>
    <id>http://yoursite.com/2020/03/04/VSCode%EB%A1%9C%20Spring%20Boot%20%EC%82%AC%EC%9A%A9%EC%8B%9C%20profile%EC%84%A4%EC%A0%95/</id>
    <published>2020-03-04T02:35:10.110Z</published>
    <updated>2020-03-04T04:21:01.016Z</updated>
    
    <content type="html"><![CDATA[<p>전 글에서 VSCode를 이용해서 spring boot project를 구동해봤습니다.<br>시작한 김에 기존 project를 local에서 구동해보려고 시도를 했는데….. local 에서 구동이 되지 않는 문제가 발생했습니다.<br><strong>결론부터 말하면 application 구동시 spring profiles 설정을 하지 않았기 때문입니다.</strong></p><h1 id="Spring-Profiles"><a href="#Spring-Profiles" class="headerlink" title="Spring Profiles"></a>Spring Profiles</h1><p>spring boot를 이용해 application 개발시 각종 설정에 대한 정보를 <strong>application.yml</strong> 에 작성합니다.<br>어떤 port를 사용할지, logging 전략은 어떤식으로 구성할지, 어떤 DB를 사용하고 해당 db에 대한 접속 정보를 작성하는 등 많은 설정을 작성하게 됩니다. (물론 중요정보가 있는 설정의 경우는 application.yml 에 설정하지 않는것을 지향합니다.)<br>그리고 해당 설정 정보는 대부분 phase마다 다르게 구성합니다. </p><p>spring은 profiles라는 기능을 통해 구동되는 환경에 따라 설정값을 구분 지을 수 있도록 해줍니다.</p><h1 id="Profiles가-설정된-application-구동"><a href="#Profiles가-설정된-application-구동" class="headerlink" title="Profiles가 설정된 application 구동"></a>Profiles가 설정된 application 구동</h1><p>예전에 개발했던 broker-api를 구동해보겠습니다.</p><h3 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h3><ul><li>아래 설정과 같이 <strong>local</strong>과 <strong>prod</strong>의 mongodb 접속 설정정보와 application의 port번호가 다르게 설정되어있다.<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">local</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">local123</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">local</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">prod</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">prod123</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">prod</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">27018</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18081</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="VSCode에서-Application-구동"><a href="#VSCode에서-Application-구동" class="headerlink" title="VSCode에서 Application 구동"></a>VSCode에서 Application 구동</h3><ul><li><p>applicatin 구동 시키면 아래처럼 logo만 출력되고 application 이 down 되어버림.<br><img src="/img/2020/03/04/1.png" alt=""></p></li><li><p>debug를 해보면 아래와 같이 <strong>java.lang.IllegalArgumentException: Could not resolve placeholder ‘spring.data.mongodb.uri’ in value “${spring.data.mongodb.uri}</strong> 오류가 발생합니다.<br><img src="/img/2020/03/04/2.png" alt=""></p></li><li><p>mongoDB 관련 configuration 에서 해당 정보를 설정 파일에서 가져오지 못하는 문제가 있습니다.<br><img src="/img/2020/03/04/3.png" alt=""></p></li></ul><h3 id="해결"><a href="#해결" class="headerlink" title="해결"></a>해결</h3><ul><li><p>위 설정과 같이 spring profiles를 사용하는 경우 application 구동시 어떤 profiles를 사용할지에 대해 정의 해줘야 합니다.</p></li><li><p>VSCode는 해당 설정을 <strong>launch.json</strong> 에서 할 수 있습니다.<br><img src="/img/2020/03/04/4.png" alt=""></p></li><li><p>args 에 spring profile 설정을 정의하겠습니다.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"java"</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Spring Boot-BrokerApiApplication&lt;broker-api&gt;"</span>,</span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceFolder&#125;"</span>,</span><br><span class="line">            <span class="attr">"console"</span>: <span class="string">"internalConsole"</span>,</span><br><span class="line">            <span class="attr">"mainClass"</span>: <span class="string">"com.saltlux.brokerapi.BrokerApiApplication"</span>,</span><br><span class="line">            <span class="attr">"projectName"</span>: <span class="string">"broker-api"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: <span class="string">"--spring.profiles.active=local"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/2020/03/04/5.png" alt=""></p></li><li><p>application 재기동<br><img src="/img/2020/03/04/6.png" alt=""><br><img src="/img/2020/03/04/7.png" alt=""></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;전 글에서 VSCode를 이용해서 spring boot project를 구동해봤습니다.&lt;br&gt;시작한 김에 기존 project를 local에서 구동해보려고 시도를 했는데….. local 에서 구동이 되지 않는 문제가 발생했습니다.&lt;br&gt;&lt;stron
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>VSCode로 Spring Boot 사용해보기</title>
    <link href="http://yoursite.com/2020/03/03/VSCode%EB%A1%9C%20Spring%20Boot%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0/"/>
    <id>http://yoursite.com/2020/03/03/VSCode%EB%A1%9C%20Spring%20Boot%20%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0/</id>
    <published>2020-03-03T00:43:15.869Z</published>
    <updated>2020-03-03T02:05:35.337Z</updated>
    
    <content type="html"><![CDATA[<p>처음 개발을 시작하면서 사용했던 IDE는 eclipse를 사용했습니다. Spring Framework를 사용하면서 STS로 갈아타서 사용하다가<br>본사와 신규로 입사한 시니어개발자 최모 군이 IntelliJ 를 사용하는 걸 보고, 팀장님과 회사를 조르고 졸라서 구매해서 사용했었습니다.<br>현재도 IntelliJ를 이용해서 개발중이지만, 이직한 회사에서는 구매해줄 것 같지 않은 분위기에 개인 라이선스를 구매해서 사용했습니다.<br>그러다 요즘 VSCode를 많이 이용한다하여 시도해봤습니다.</p><h1 id="사전작업"><a href="#사전작업" class="headerlink" title="사전작업"></a>사전작업</h1><p>VSCode 는 설치되어있다는 가정하에 진행하겠습니다.<br>Mac OS 에서 진행했습니다.</p><h3 id="Market에서-확장-Plugin-download"><a href="#Market에서-확장-Plugin-download" class="headerlink" title="Market에서 확장 Plugin download"></a>Market에서 확장 Plugin download</h3><ol><li><strong>Java Extension Pack</strong> (해당 Plugin을 설치하면 아래 Plugin 도 같이 설치가 됨 (Mac기준 Windows 에서는 안깔려있는데 이유는 모르겠음))<ul><li>Maven for Java (<code>Gradle을 사용하기 위해서는 Gradle Language Support 를 설치해야 합니다.</code>)</li><li>Debegger for Java</li><li>Java Test Runner</li><li>Languages Support for Java</li><li>Java Dependency Viewer</li></ul></li></ol><p><img src="/img/2020/03/03/1.png" alt=""></p><ol start="2"><li><strong>Spring Boot Extension Pack</strong> (아래 Plugin도 같이 설치가 됨)<ul><li>Spring Initializr Java Support </li><li>Spring Boot Tools</li></ul></li></ol><p><img src="/img/2020/03/03/2.png" alt=""></p><ol start="3"><li>Tomcat for java (Tomcat을 사용하는 Project가 있는경우 설치하자)</li><li>Checkstyle for Java (<code>선택</code>)</li><li>Java Code Generators (<code>선택</code>)</li></ol><h3 id="jdk경로-설정"><a href="#jdk경로-설정" class="headerlink" title="jdk경로 설정"></a>jdk경로 설정</h3><ol><li>Code &gt; Preferences &gt; Settings<br><img src="/img/2020/03/03/3.png" alt=""></li><li>Search settings에 <code>jdk</code> 입력하면 Java:Home 의 setting 파일을 수정할 수 있습니다. (<code>Edit in settings.json 클릭</code>)<br><img src="/img/2020/03/03/4.png" alt=""></li><li>java.home 설정<br><img src="/img/2020/03/03/4-1.png" alt=""></li></ol><h1 id="간단한-Spring-Boot-Project-만들어보기"><a href="#간단한-Spring-Boot-Project-만들어보기" class="headerlink" title="간단한 Spring Boot Project 만들어보기"></a>간단한 Spring Boot Project 만들어보기</h1><ol><li>cmd + shift + p 입력 후 <code>spring initializr</code> 입력 후 선택 (전 spring initializr: Generate a Gradle Project를 선택했습니다.)<br><img src="/img/2020/03/03/5.png" alt=""></li><li>language 선택 (전 Java를 선택하겠습니다.)</li><li>group ID 지정<br><img src="/img/2020/03/03/7.png" alt=""></li><li>artifact ID 지정<br><img src="/img/2020/03/03/8.png" alt=""></li><li>spring boot version 선택<br><img src="/img/2020/03/03/9.png" alt=""></li><li>dependency 설정<br><img src="/img/2020/03/03/10.png" alt=""></li><li>설치 folder 설정<br><img src="/img/2020/03/03/11.png" alt=""></li><li>설정 완료<br><img src="/img/2020/03/03/12.png" alt=""></li></ol><h1 id="간단한-Application생성-후-실행해보기"><a href="#간단한-Application생성-후-실행해보기" class="headerlink" title="간단한 Application생성 후 실행해보기"></a>간단한 Application생성 후 실행해보기</h1><ol><li>간단하게 입력받은 text를 화면에 보여주는 기능을 구현해보겠습니다.<br><img src="/img/2020/03/03/13.png" alt=""></li><li>local 실행하기<br><img src="/img/2020/03/03/14.png" alt=""><br><img src="/img/2020/03/03/15.png" alt=""><br><img src="/img/2020/03/03/16.png" alt=""></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;처음 개발을 시작하면서 사용했던 IDE는 eclipse를 사용했습니다. Spring Framework를 사용하면서 STS로 갈아타서 사용하다가&lt;br&gt;본사와 신규로 입사한 시니어개발자 최모 군이 IntelliJ 를 사용하는 걸 보고, 팀장님과 회사
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Provisioning - 3. Ansible을 이용해 kubernetes cluster 생성하기</title>
    <link href="http://yoursite.com/2020/02/28/Provisioning%20-%203.%20Ansible%EC%9D%84%20%EC%9D%B4%EC%9A%A9%ED%95%B4%20kubernetes%20cluster%20%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0/"/>
    <id>http://yoursite.com/2020/02/28/Provisioning%20-%203.%20Ansible%EC%9D%84%20%EC%9D%B4%EC%9A%A9%ED%95%B4%20kubernetes%20cluster%20%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0/</id>
    <published>2020-02-28T00:23:48.365Z</published>
    <updated>2020-02-28T00:33:12.785Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>Ansible을 이용해서 k8s cluster을 생성해보겠습니다.<br>cluster를 생성하는 방법은 <a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">Container Orchestration - 4. kubernetes Install</a>에 작성 한 것과 같이 <strong>master</strong> 1대와 <strong>node</strong> 2대를 셋팅해 보겠습니다.<br><strong>기존에 공유드린 것과 같이 master / node 클러스터 구성시 <code>방화벽작업</code>을 하고 <code>docker를 설치</code>하고 <code>k8s 관련 install</code> 작업을 했습니다. 이러한 작업을 ansible playbook 을 이용해 한번에 처리해보도록 하겠습니다.</strong></p><h1 id="1-구성"><a href="#1-구성" class="headerlink" title="1. 구성"></a>1. 구성</h1><table><thead><tr><th>host name</th><th>역할</th></tr></thead><tbody><tr><td>ansible-manager</td><td>Ansible 제어 노드 및 작업자용 노드</td></tr><tr><td>ansible-master</td><td>k8s Master</td></tr><tr><td>ansible-node1</td><td>k8s Node</td></tr><tr><td>ansible-node2</td><td>k9s Node</td></tr></tbody></table><p><img src="/img/2020/02/28/2.png" alt=""></p><h1 id="2-Ansible-설치"><a href="#2-Ansible-설치" class="headerlink" title="2. Ansible 설치"></a>2. Ansible 설치</h1><h3 id="2-1-ansible-manager-에-Ansible-설치"><a href="#2-1-ansible-manager-에-Ansible-설치" class="headerlink" title="2.1 ansible-manager 에 Ansible 설치"></a>2.1 ansible-manager 에 Ansible 설치</h3><p>ansible-manager 에 Ansible을 설치하겠습니다. Ansible 이 다른 IaC보다 편한점이 <strong>Pull 방식이 아닌 Push 방식으로 대상 서버에는 별도의 셋팅이 필요하지 않습니다.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y eple-release</span><br><span class="line">yum install -y ansible</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/28/3.png" alt=""></p><h3 id="2-2-Password-없이-접속이-가능하도록-작업"><a href="#2-2-Password-없이-접속이-가능하도록-작업" class="headerlink" title="2.2 Password 없이 접속이 가능하도록 작업"></a>2.2 Password 없이 접속이 가능하도록 작업</h3><ul><li><p>ROOT 로그인을 허용하도록 설정을 수정합니다. <code>ansible-master</code>, <code>ansible-node1</code>, <code>ansible-node2</code> 에서 작업</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin yes</span><br><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure></li><li><p><strong>ansible-manager</strong> 에서 SSH키 생성을 합니다. <strong>password 는 별도로 작성하지 않습니다.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/28/4.png" alt=""></p></li><li><p>생성한 key를 ansible-master, ansible-node1, ansible-node2 에 복사해줍니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id [serverIP]</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/28/5.png" alt=""></p></li><li><p>ssh 접속이 되는지 확인합니다</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh [server_host_name]</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/28/6.png" alt=""></p></li></ul><h3 id="2-1-Inventory를-작성하여-Ping-Test"><a href="#2-1-Inventory를-작성하여-Ping-Test" class="headerlink" title="2.1 Inventory를 작성하여 Ping Test"></a>2.1 Inventory를 작성하여 Ping Test</h3><ul><li><p>다음과 같이 host파일을 생성합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">master ansible_host=10.128.0.40 ansible_user=root</span><br><span class="line"></span><br><span class="line">[nodes]</span><br><span class="line">node1 ansible_host=10.128.0.42 ansible_user=root</span><br><span class="line">node2 ansible_host=10.128.0.43 ansible_user=root</span><br></pre></td></tr></table></figure></li><li><p>ping 명령어를 통해 연결상태를 확인합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -m ping all -i hosts</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/28/7.png" alt=""></p></li></ul><h1 id="3-Ansible을-이용해-k8s-클러스터-구성해보기"><a href="#3-Ansible을-이용해-k8s-클러스터-구성해보기" class="headerlink" title="3. Ansible을 이용해 k8s 클러스터 구성해보기"></a>3. Ansible을 이용해 k8s 클러스터 구성해보기</h1><h3 id="3-1-setup-yml-작성"><a href="#3-1-setup-yml-작성" class="headerlink" title="3.1 setup.yml 작성"></a>3.1 setup.yml 작성</h3><p><code>master</code> <code>nodes</code> 에 공통으로 설정할 내용과 k8s 설치용 playbook 파일을 작성합니다.<br><a href="https://raw.githubusercontent.com/thinkub/ansible-k8s-cluster/master/setup.yml" target="_blank" rel="noopener">https://raw.githubusercontent.com/thinkub/ansible-k8s-cluster/master/setup.yml</a></p><h3 id="3-2-playbook-실행-shell-script-작성"><a href="#3-2-playbook-실행-shell-script-작성" class="headerlink" title="3.2 playbook 실행 shell script 작성"></a>3.2 playbook 실행 shell script 작성</h3><p>작성한 playbook 용 yaml 파일을 실행할 shell script 를 작성합니다.<br><a href="https://raw.githubusercontent.com/thinkub/ansible-k8s-cluster/master/build-cluster.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/thinkub/ansible-k8s-cluster/master/build-cluster.sh</a></p><h3 id="3-3-실행"><a href="#3-3-실행" class="headerlink" title="3.3 실행"></a>3.3 실행</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build-cluster.sh</span><br></pre></td></tr></table></figure><h3 id="3-4-결과"><a href="#3-4-결과" class="headerlink" title="3.4 결과"></a>3.4 결과</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">TASK [add Kubernetes YUM repository] ***************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line">changed: [node1]</span><br><span class="line">changed: [node2]</span><br><span class="line"></span><br><span class="line">TASK [install kubelet] ******************************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line">changed: [node1]</span><br><span class="line">changed: [node2]</span><br><span class="line"></span><br><span class="line">TASK [install kubeadm] ******************************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line">changed: [node1]</span><br><span class="line">changed: [node2]</span><br><span class="line"></span><br><span class="line">TASK [start kubelet] ********************************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line">changed: [node1]</span><br><span class="line">changed: [node2]</span><br><span class="line"></span><br><span class="line">TASK [install kubectl] ******************************************************************************************</span><br><span class="line">ok: [master]</span><br><span class="line">ok: [node1]</span><br><span class="line">ok: [node2]</span><br><span class="line"></span><br><span class="line">PLAY [master] ***************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] ******************************************************************************************</span><br><span class="line">ok: [master]</span><br><span class="line"></span><br><span class="line">TASK [initialize the cluster] ***********************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line"></span><br><span class="line">TASK [create .kube directory] ***********************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line"></span><br><span class="line">TASK [copy admin.conf to user kube config] ********************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line"></span><br><span class="line">TASK [install Pod network] **************************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line"></span><br><span class="line">PLAY [master] ***************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [get join <span class="built_in">command</span>] *****************************************************************************************</span><br><span class="line">changed: [master]</span><br><span class="line"></span><br><span class="line">TASK [<span class="built_in">set</span> join <span class="built_in">command</span>] *****************************************************************************************</span><br><span class="line">ok: [master]</span><br><span class="line"></span><br><span class="line">PLAY [nodes] ****************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] ******************************************************************************************</span><br><span class="line">ok: [node1]</span><br><span class="line">ok: [node2]</span><br><span class="line"></span><br><span class="line">TASK [join cluster] *********************************************************************************************</span><br><span class="line">changed: [node1]</span><br><span class="line">changed: [node2]</span><br><span class="line"></span><br><span class="line">PLAY RECAP ******************************************************************************************************</span><br><span class="line">master                     : ok=21   changed=16   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   </span><br><span class="line">node1                      : ok=16   changed=12   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   </span><br><span class="line">node2                      : ok=16   changed=12   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</span><br></pre></td></tr></table></figure><ul><li>master 에서 cluster 확인하기<br><img src="/img/2020/02/28/8.png" alt=""></li></ul><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://zerobig-k8s.tistory.com/31" target="_blank" rel="noopener">https://zerobig-k8s.tistory.com/31</a><br><a href="https://github.com/zer0big/ansible-k8s-cluster" target="_blank" rel="noopener">https://github.com/zer0big/ansible-k8s-cluster</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Provisioning - 2. Ansible</title>
    <link href="http://yoursite.com/2020/02/28/Provisioning%20-%202.%20Ansible/"/>
    <id>http://yoursite.com/2020/02/28/Provisioning%20-%202.%20Ansible/</id>
    <published>2020-02-28T00:18:58.751Z</published>
    <updated>2020-02-28T00:33:11.891Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h1><p><img src="/img/2020/02/28/1.png" alt=""></p><p>Ansible은 오픈 소스 소프트웨어 프로비저닝, 구성 관리, 애플리케이션 전개 도구입니다. 수많은 유닉스 계열 시스템에서 실행되며 유닉스 계열 운영 체제 및 마이크로소프트 윈도우의 구성이 가능합니다. 시스템 구성을 기술하기 위해 자체 선언형 언어를 포함하고 있습니다.<br>python으로 개발되고 <strong>YAML</strong> 언어를 통해 정의하며 json으로 통신합니다. (python Github project 중 상위 6위) </p><p><strong>IaC (Infrastructure as a Code)</strong> 라는 개념에서 나온 기술로 여러대의 서버를 효율적으로 관리하기 위해 만들어진 자동화 툴입니다.</p><h3 id="1-Ansible-특징"><a href="#1-Ansible-특징" class="headerlink" title="1. Ansible 특징"></a>1. Ansible 특징</h3><ul><li>SSH 통신, 빠른 provision 이 가능합니다.</li><li>추후 상용 환경에서 사용할 때 agent 기반이면 방화벽 이슈, agent 데몬 관리라는 불편한 점이 존재합니다. (agent 방식의 장점도 물론 존재합니다. 확장성, 대규모 provision을 할 경우 매우 효과적입니다. 대신 서버와 통신하는 부분이 고도화되기 때문에 빠르고 간단한 provision을 할 수 없습니다.</li><li>자동 배포 환경이 쉽습니다.</li><li>개발 가능성이 높은 오픈소스 입니다.</li><li>멱등성을 제공합니다.</li><li>대상 서버에 별도 에이전트를 설치 하지 않아도 됩니다. </li><li>설정 파일은 YAML 형식으로 가독성이 좋습니다.</li><li>700개 이상 대다수의 서버와 네트워크 장비를 지원합니다.</li></ul><h3 id="2-Ansible-구성요소"><a href="#2-Ansible-구성요소" class="headerlink" title="2. Ansible 구성요소"></a>2. Ansible 구성요소</h3><p>Ansible에는 크게 3가지 요소가 있습니다. Inventory, playbook, module 입니다. 간단히 말해서 <strong>어디서(Inventory)</strong>, <strong>무엇을(playbook)</strong>, <strong>어떻게(module)</strong> 수행할 지를 정의합니다.<br>module은 playbook이 정의된 파일 내부에서 사용됩니다.</p><h4 id="2-1-Inventory"><a href="#2-1-Inventory" class="headerlink" title="2.1 Inventory"></a>2.1 Inventory</h4><p>배포 대상을 정리한 파일입니다. 간단히 말해 host ip와 접근방식등을 기록해 놓은 파일입니다. yaml문법을 적용하지 않았고 기본파일은 <strong>/etc/ansible/hosts</strong> 를 읽게 하거나, 따로 inventory 파일을 만들고 옵션을 주어 동작하게 할 수 있습니다. </p><ul><li>ex)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">master ansible_host=10.128.0.37 ansible_user=root</span><br><span class="line"></span><br><span class="line">[workers]</span><br><span class="line">worker1 ansible_host=10.128.0.38 ansible_user=root</span><br><span class="line">worker2 ansible_host=10.128.0.39 ansible_user=root</span><br></pre></td></tr></table></figure><h4 id="2-2-ad-hoc"><a href="#2-2-ad-hoc" class="headerlink" title="2.2 ad-hoc"></a>2.2 ad-hoc</h4>임시적으로 수행하는 의미로 ansible의 playbook을 작성하여 수행하는 것이 아니라 임시적으로 작업을 수행하는 방법입니다.</li></ul><h4 id="2-3-playbook"><a href="#2-3-playbook" class="headerlink" title="2.3 playbook"></a>2.3 playbook</h4><p>다수의 서버에 대한 배포시스템의 기본 단위입니다. Inventory에 작성된 서버들을 대상으로 실행 스크립트를 정의한 파일입니다. YAML 문법을사용합니다.</p><ul><li>ex<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">Docker</span></span><br><span class="line">     <span class="attr">yum:</span></span><br><span class="line">       <span class="attr">name:</span> <span class="string">docker</span></span><br><span class="line">       <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">       <span class="attr">update_cache:</span> <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">Docker</span></span><br><span class="line">     <span class="attr">service:</span></span><br><span class="line">       <span class="attr">name:</span> <span class="string">docker</span></span><br><span class="line">       <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">       <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">       </span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Stop</span> <span class="string">and</span> <span class="string">disable</span> <span class="string">firewalld.</span></span><br><span class="line">     <span class="attr">service:</span></span><br><span class="line">       <span class="attr">name:</span> <span class="string">firewalld</span></span><br><span class="line">       <span class="attr">state:</span> <span class="string">stopped</span></span><br><span class="line">       <span class="attr">enabled:</span> <span class="literal">False</span>       </span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.ansible.com/" target="_blank" rel="noopener">https://www.ansible.com/</a><br><a href="https://ko.wikipedia.org/wiki/Ansible" target="_blank" rel="noopener">https://ko.wikipedia.org/wiki/Ansible</a><br><a href="https://brownbears.tistory.com/358" target="_blank" rel="noopener">https://brownbears.tistory.com/358</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Provisioning - 1. Provisioning</title>
    <link href="http://yoursite.com/2020/02/28/Provisioning%20-%201.%20Provisioning/"/>
    <id>http://yoursite.com/2020/02/28/Provisioning%20-%201.%20Provisioning/</id>
    <published>2020-02-28T00:13:18.692Z</published>
    <updated>2020-02-28T00:33:11.083Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>지금까지 Docker와 Container Orchestration 인 Kubernetes 에 대해서 알아봤습니다.<br>k8s를 사용하기 위해서는 결국 Master / Node에 k8s를 사용하기 위한 설정들을 미리 해둬야합니다.<br><strong>이러한 설정들을 서버가 증설 되거나 또 다른 프로젝트에 대한 배포환경을 만들때 마다 반복한다면 꽤 불편할 거라 생각됩니다.</strong></p><h1 id="1-Provisioning-프로비저닝-이란"><a href="#1-Provisioning-프로비저닝-이란" class="headerlink" title="1. Provisioning (프로비저닝) 이란?"></a>1. Provisioning (프로비저닝) 이란?</h1><p>프로비저닝은 사용자의 요구에 맞게 시스템 자원을 할당, 배치, 배포해 두었다가 <strong>필요 시 시스템을 즉시 사용할 수 있는 상태로 미리 준비해 두는 것</strong>을 말합니다. </p><p>여러 프로비저닝 오픈소스중 저희는 <strong>Ansible (앤서블)</strong> 에 대해 알아볼 예정입니다.<br>목표는 <strong>Ansible</strong>을 이용해 k8s의 Master, Node 의 환경구성 자동화를 진행해 보겠습니다.</p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%8B%9D" target="_blank" rel="noopener">https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%8B%9D</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Container Orchestration - 7. kubectl CLI</title>
    <link href="http://yoursite.com/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/"/>
    <id>http://yoursite.com/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/</id>
    <published>2020-02-26T06:06:40.736Z</published>
    <updated>2020-02-28T00:33:00.903Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>쿠버네티스는 클러스터 API 서버와 통신하기 위해 <code>kubectl</code>이라는 커맨드라인 인터페이스를 사용합니다. 클러스터와 상호 작용하고 바라는 상태를 설정하거나 수정하기 위해서 쿠버네티스 API를 직접 사용할 수도 있습니다. </p><h1 id="1-Syntax"><a href="#1-Syntax" class="headerlink" title="1. Syntax"></a>1. Syntax</h1><p>kubectl의 기본 구분은 다음과 같습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl [<span class="built_in">command</span>] [TYPE] [NAME] [flag]</span><br></pre></td></tr></table></figure><ul><li><p><strong>command</strong></p><ul><li>create, get, describe, delete 등 자원에 대해 수행하려는 조작을 지정합니다.</li></ul></li><li><p><strong>TYPE</strong></p><ul><li>리소스에 대한 유형을 지정하며, 대소 문자를 구분하지 않으나, 단수, 복수, 약식을 지정할 수 있습니다.</li><li>다음 예시는 모두 같은 출력을 실행합니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod pod1</span><br><span class="line">kubectl get pods pod1</span><br><span class="line">kubectl get po pod1</span><br></pre></td></tr></table></figure><img src="/img/2020/02/26/44.png" alt=""></li></ul></li><li><p><strong>NAME</strong></p><ul><li>리소스의 이름을 지정합니다. 이름은 대소 문자를 구분합니다. 이름을 생략하면 모든 리소스에 대한 세부 정보가 표시됩니다<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure><img src="/img/2020/02/26/45.png" alt=""></li><li>여러 리소스에 대한 조작을 수행 할 때 유형 및 이름별로 각 리소스를 지정하거나 하나 이상의 파일을 지정할 수 있습니다.<ul><li>리소스가 모두 같은 유형인 경우 <strong>TYPE NAME1 NAME2 NAME3 …</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod pod1 pod2 pod3 ...</span><br></pre></td></tr></table></figure></li><li>여러 리소스 유형을 개별적으로 지정하는경우 <strong>TYPE1/NAME1 TYPE1/NAME2 TYPE2/NAME3 …</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod/pod1 pod/pod2 service/service1 ...</span><br></pre></td></tr></table></figure></li></ul></li><li>하나 이상의 파일로 리소스를 지정 <strong>-f file1 -f file2 -f file</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -f ./pod.yaml</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>flag</strong></p><ul><li>선택적 플래그를 지정합니다. 예를 들어, -s 또는 –server 플래그를 사용하여 Kubernetes API 서버의 주소와 포트를 지정할 수 있습니다.</li></ul></li></ul><h1 id="2-Operations"><a href="#2-Operations" class="headerlink" title="2. Operations"></a>2. Operations</h1><p>다음 표에는 모든 kubectl 작업에 대한 간단한 설명과 일반적인 구문이 포함되어 있습니다.<br><br>자세한 사항은 <a href="https://kubernetes.io/docs/reference/kubectl/kubectl/" target="_blank" rel="noopener">이곳</a> 을 참고해주세요.</p><table><thead><tr><th>Operation</th><th>Syntax</th><th>Description</th></tr></thead><tbody><tr><td>annotate</td><td>kubectl annotate (-f FILENAME | TYPE NAME | TYPE/NAME) KEY_1=VAL_1 … KEY_N=VAL_N [–overwrite] [–all] [–resource-version=version] [flags]</td><td>하나 이상의 리소스 주석을 추가하거나 업데이트</td></tr><tr><td>api-versions</td><td>kubectl api-versions [flags]</td><td>사용가능한 API 버전 List</td></tr><tr><td>apply</td><td>kubectl apply -f FILENAME [flags]</td><td>파일 또는 stdin에서 자원에 구성 변경 사항을 적용</td></tr><tr><td>attach</td><td>kubectl attach POD -c CONTAINER [-i] [-t] [flags]</td><td>실행중인 컨테이너에 연결하여 출력 스트림을 보거나 컨테이너 (stdin)와 상호 작용하십시오.</td></tr><tr><td>autoscale</td><td>kubectl autoscale (-f FILENAME | TYPE NAME | TYPE/NAME) [–min=MINPODS] –max=MAXPODS [–cpu-percent=CPU] [flags]</td><td>복제 컨트롤러에서 관리하는 포드 세트를 자동으로 조정합니다.</td></tr><tr><td>cluster-info</td><td>kubectl cluster-info [flags]</td><td>클러스터의 마스터 및 서비스에 대한 엔드 포인트 정보를 표시하십시오.</td></tr><tr><td>config</td><td>kubectl config SUBCOMMAND [flags]</td><td>kubeconfig 파일을 수정합니다. 세부 사항은 개별 부속 명령을 참조하십시오.</td></tr><tr><td>create</td><td>kubectl create -f FILENAME [flags]</td><td>파일 또는 stdin에서 하나 이상의 자원을 작성하십시오.</td></tr><tr><td>delete</td><td>kubectl delete (-f FILENAME | TYPE [NAME | /NAME | -l label | –all]) [flags]</td><td>파일, stdin에서 또는 label selectors, names, resource selectors 또는 resources 지정하여 resources를 삭제하십시오.</td></tr><tr><td>describe</td><td>kubectl describe (-f FILENAME | TYPE [NAME_PREFIX | /NAME | -l label]) [flags]</td><td>하나 이상의 리소스의 자세한 상태를 표시합니다.</td></tr><tr><td>diff</td><td>kubectl diff -f FILENAME [flags]</td><td>라이브 구성에 대한 Diff 파일 또는 표준 입력 (BETA)</td></tr><tr><td>edit</td><td>kubectl edit (-f FILENAME | TYPE NAME | TYPE/NAME) [flags]</td><td>기본 편집기를 사용하여 서버에서 하나 이상의 자원 정의를 편집하고 업데이트하십시오.</td></tr><tr><td>exec</td><td>kubectl exec POD [-c CONTAINER] [-i] [-t] [flags] [– COMMAND [args…]]</td><td>pod의 컨테이너에 대해 명령을 실행하십시오.</td></tr><tr><td>explain</td><td>kubectl explain [–recursive=false] [flags]</td><td>다양한 리소스에 대한 설명서를 받으십시오. pods, nodes, services 등</td></tr><tr><td>expose</td><td>kubectl expose (-f FILENAME | TYPE NAME | TYPE/NAME) [–port=port] [–protocol=TCP|UDP] [–target-port=number-or-name] [–name=name] [–external-ip=external-ip-of-service] [–type=type] [flags]</td><td>replication controller, service 또는 pod를 새로운 Kubernetes 서비스로 노출하십시오.</td></tr><tr><td>get</td><td>kubectl get (-f FILENAME | TYPE [NAME | /NAME | -l label]) [–watch] [–sort-by=FIELD] [[-o | –output]=OUTPUT_FORMAT] [flags]</td><td>하나 이상의 리소스를 나열하십시오.</td></tr><tr><td>label</td><td>kubectl label (-f FILENAME | TYPE NAME | TYPE/NAME) KEY_1=VAL_1 … KEY_N=VAL_N [–overwrite] [–all] [–resource-version=version] [flags]</td><td>하나 이상의 리소스 레이블 추가 또는 업데이트</td></tr><tr><td>logs</td><td>kubectl logs POD [-c CONTAINER] [–follow] [flags]</td><td>컨테이너 내부의 pod log를 출력합니다.</td></tr><tr><td>patch</td><td>kubectl patch (-f FILENAME | TYPE NAME | TYPE/NAME) –patch PATCH [flags]</td><td>전략적 병합 패치 프로세스를 사용하여 리소스의 하나 이상의 필드를 업데이트하십시오.</td></tr><tr><td>port-forward</td><td>kubectl port-forward POD [LOCAL_PORT:]REMOTE_PORT […[LOCAL_PORT_N:]REMOTE_PORT_N] [flags]</td><td>하나 이상의 로컬 포트를 pod로 전달합니다.</td></tr><tr><td>proxy</td><td>kubectl proxy [–port=PORT] [–www=static-dir] [–www-prefix=prefix] [–api-prefix=prefix] [flags]</td><td>Kubernetes API 서버에 프록시를 실행하십시오.</td></tr><tr><td>replace</td><td>kubectl replace -f FILENAME</td><td>파일 또는 stdin에서 리소스를 바꾸십시오.</td></tr><tr><td>rolling-update</td><td>kubectl rolling-update OLD_CONTROLLER_NAME ([NEW_CONTROLLER_NAME] –image=NEW_CONTAINER_IMAGE | -f NEW_CONTROLLER_SPEC) [flags]</td><td>지정된 replication controller 및 해당 pod를 점차적으로 교체하여 rolling update를 수행하십시오.</td></tr><tr><td>run</td><td>kubectl run NAME –image=image [–env=”key=value”] [–port=port] [–replicas=replicas] [–dry-run=bool] [–overrides=inline-json] [flags]</td><td>클러스터에서 지정된 이미지를 실행하십시오.</td></tr><tr><td>scale</td><td>kubectl scale (-f FILENAME | TYPE NAME | TYPE/NAME) –replicas=COUNT [–resource-version=version] [–current-replicas=count] [flags]</td><td>지정된 replacation controller의 크기를 업데이트하십시오.</td></tr><tr><td>version</td><td>kubectl version [–client] [flags]</td><td>클라이언트와 서버에서 실행중인 Kubernetes 버전을 표시합니다.</td></tr></tbody></table><h1 id="3-Resource-types"><a href="#3-Resource-types" class="headerlink" title="3. Resource types"></a>3. Resource types</h1><table><thead><tr><th>Resource Name</th><th>ShortNames</th><th>API Group</th><th>Namespaced</th><th>Resource kind</th></tr></thead><tbody><tr><td>bindings</td><td></td><td></td><td>true</td><td>Binding</td></tr><tr><td>componentstatuses</td><td>cs</td><td></td><td>false</td><td>ComponentStatus</td></tr><tr><td>configmaps</td><td>cm</td><td></td><td>true</td><td>ConfigMap</td></tr><tr><td>endpoints</td><td>ep</td><td></td><td>true</td><td>Endpoints</td></tr><tr><td>limitranges</td><td>limits</td><td></td><td>true</td><td>LimitRange</td></tr><tr><td>namespaces</td><td>ns</td><td></td><td>false</td><td>Namespace</td></tr><tr><td>nodes</td><td>no</td><td></td><td>false</td><td>Node</td></tr><tr><td>persistentvolumeclaims</td><td>pvc</td><td></td><td>true</td><td>PersistentVolumeClaim</td></tr><tr><td>persistentvolumes</td><td>pv</td><td></td><td>false</td><td>PersistentVolume</td></tr><tr><td>pods</td><td>po</td><td></td><td>true</td><td>Pod</td></tr><tr><td>podtemplates</td><td></td><td></td><td>true</td><td>PodTemplate</td></tr><tr><td>replicationcontrollers</td><td>rc</td><td></td><td>true</td><td>ReplicationController</td></tr><tr><td>resourcequotas</td><td>quota</td><td></td><td>true</td><td>ResourceQuota</td></tr><tr><td>secrets</td><td></td><td></td><td>true</td><td>Secret</td></tr><tr><td>serviceaccounts</td><td>sa</td><td></td><td>true</td><td>ServiceAccount</td></tr><tr><td>services</td><td>svc</td><td></td><td>true</td><td>Service</td></tr><tr><td>mutatingwebhookconfigurations</td><td></td><td>admissionregistration.k8s.io</td><td>false</td><td>MutatingWebhookConfiguration</td></tr><tr><td>validatingwebhookconfigurations</td><td></td><td>admissionregistration.k8s.io</td><td>false</td><td>ValidatingWebhookConfiguration</td></tr><tr><td>customresourcedefinitions</td><td>crd, crds</td><td>apiextensions.k8s.io</td><td>false</td><td>CustomResourceDefinition</td></tr><tr><td>apiservices</td><td></td><td>apiregistration.k8s.io</td><td>false</td><td>APIService</td></tr><tr><td>controllerrevisions</td><td></td><td>apps</td><td>true</td><td>ControllerRevision</td></tr><tr><td>daemonsets</td><td>ds</td><td>apps</td><td>true</td><td>DaemonSet</td></tr><tr><td>deployments</td><td>deploy</td><td>apps</td><td>true</td><td>Deployment</td></tr><tr><td>replicasets</td><td>rs</td><td>apps</td><td>true</td><td>ReplicaSet</td></tr><tr><td>statefulsets</td><td>sts</td><td>apps</td><td>true</td><td>StatefulSet</td></tr><tr><td>tokenreviews</td><td></td><td>authentication.k8s.io</td><td>false</td><td>TokenReview</td></tr><tr><td>localsubjectaccessreviews</td><td></td><td>authorization.k8s.io</td><td>true</td><td>LocalSubjectAccessReview</td></tr><tr><td>selfsubjectaccessreviews</td><td></td><td>authorization.k8s.io</td><td>false</td><td>SelfSubjectAccessReview</td></tr><tr><td>selfsubjectrulesreviews</td><td></td><td>authorization.k8s.io</td><td>false</td><td>SelfSubjectRulesReview</td></tr><tr><td>subjectaccessreviews</td><td></td><td>authorization.k8s.io</td><td>false</td><td>SubjectAccessReview</td></tr><tr><td>horizontalpodautoscalers</td><td>hpa</td><td>autoscaling</td><td>true</td><td>HorizontalPodAutoscaler</td></tr><tr><td>cronjobs</td><td>cj</td><td>batch</td><td>true</td><td>CronJob</td></tr><tr><td>jobs</td><td></td><td>batch</td><td>true</td><td>Job</td></tr><tr><td>certificatesigningrequests</td><td>csr</td><td>certificates.k8s.io</td><td>false</td><td>CertificateSigningRequest</td></tr><tr><td>leases</td><td></td><td>coordination.k8s.io</td><td>true</td><td>Lease</td></tr><tr><td>events</td><td>ev</td><td>events.k8s.io</td><td>true</td><td>Event</td></tr><tr><td>ingresses</td><td>ing</td><td>extensions</td><td>true</td><td>Ingress</td></tr><tr><td>networkpolicies</td><td>netpol</td><td>networking.k8s.io</td><td>true</td><td>NetworkPolicy</td></tr><tr><td>poddisruptionbudgets</td><td>pdb</td><td>policy</td><td>true</td><td>PodDisruptionBudget</td></tr><tr><td>podsecuritypolicies</td><td>psp</td><td>policy</td><td>false</td><td>PodSecurityPolicy</td></tr><tr><td>clusterrolebindings</td><td></td><td>rbac.authorization.k8s.io</td><td>false</td><td>ClusterRoleBinding</td></tr><tr><td>clusterroles</td><td></td><td>rbac.authorization.k8s.io</td><td>false</td><td>ClusterRole</td></tr><tr><td>rolebindings</td><td></td><td>rbac.authorization.k8s.io</td><td>true</td><td>RoleBinding</td></tr><tr><td>roles</td><td></td><td>rbac.authorization.k8s.io</td><td>true</td><td>Role</td></tr><tr><td>priorityclasses</td><td>pc</td><td>scheduling.k8s.io</td><td>false</td><td>PriorityClass</td></tr><tr><td>csidrivers</td><td></td><td>storage.k8s.io</td><td>false</td><td>CSIDriver</td></tr><tr><td>csinodes</td><td></td><td>storage.k8s.io</td><td>false</td><td>CSINode</td></tr><tr><td>storageclasses</td><td>sc</td><td>storage.k8s.io</td><td>false</td><td>StorageClass</td></tr><tr><td>volumeattachments</td><td></td><td>storage.k8s.io</td><td>false</td><td>VolumeAttachment</td></tr></tbody></table><h3 id="3-1-Example"><a href="#3-1-Example" class="headerlink" title="3.1 Example"></a>3.1 Example</h3><ul><li><p>node 정보 확인</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get no</span><br><span class="line">kubectl get node</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/46.png" alt=""></p></li><li><p>pod 확인</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get po</span><br><span class="line">kubectl get pod</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/47.png" alt=""></p></li><li><p>service 확인</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc</span><br><span class="line">kubectl get service</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/48.png" alt=""></p></li><li><p>deployments 확인</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy</span><br><span class="line">kubectl get deployments</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/49.png" alt=""></p></li></ul><h1 id="4-Output-Option"><a href="#4-Output-Option" class="headerlink" title="4. Output Option"></a>4. Output Option</h1><p>모든 kubectl 명령의 기본 출력 형식은 사람이 읽을 수있는 일반 텍스트 형식입니다. 특정 형식으로 터미널 창에 세부 사항을 출력하려면 지원되는 kubectl 명령에 -o 또는 –output 플래그를 추가 할 수 있습니다.</p><h3 id="4-1-Syntax"><a href="#4-1-Syntax" class="headerlink" title="4.1 Syntax"></a>4.1 Syntax</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl [command] [TYPE] [NAME] -o &lt;output_format&gt;</span><br></pre></td></tr></table></figure><ul><li>kubectl 조작에 따라 다음 출력 형식이 지원됩니다.</li></ul><table><thead><tr><th>Output format</th><th>Description</th></tr></thead><tbody><tr><td>-o custom-columns=&lt;spec&gt;</td><td>쉼표로 구분 된 사용자 정의 열 목록을 사용하여 테이블을 보여줍니다.</td></tr><tr><td>-o custom-columns-file=&lt;filename&gt;</td><td>&lt;filename&gt; 파일에서 사용자 정의 열 템플리트를 사용하여 테이블을 보여줍니다.</td></tr><tr><td>-o json</td><td>JSON 형식의 API 객체를 보여줍니다.</td></tr><tr><td>-o jsonpath=&lt;template&gt;</td><td>jsonpath 표현식에 정의 된 필드를 보여줍니다.</td></tr><tr><td>-o jsonpath-file=&lt;filename&gt;</td><td>&lt;filename&gt; 파일에서 jsonpath 표현식으로 정의 된 필드를 보여줍니다.</td></tr><tr><td>-o name</td><td>리소스 이름 만 보여줍니다.</td></tr><tr><td>-o wide</td><td>추가 정보가 포함 된 일반 텍스트 형식으로 보여줍니다. pod의 경우 노드 이름이 포함됩니다.</td></tr><tr><td>-o yaml</td><td>YAML 형식의 API 객체를 보여줍니다.</td></tr></tbody></table><h3 id="4-2-Example"><a href="#4-2-Example" class="headerlink" title="4.2 Example"></a>4.2 Example</h3><ul><li>pod 세부정보를 yaml 파일로 출력하기<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod storm-684494d768-8nkm7 -o yaml</span><br></pre></td></tr></table></figure><img src="/img/2020/02/26/50.png" alt=""></li></ul><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://kubernetes.io/docs/reference/kubectl/overview/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/kubectl/overview/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Container Orchestration - 6. kubenetes를 이용해 배포해보기</title>
    <link href="http://yoursite.com/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes%EB%A5%BC%20%EC%9D%B4%EC%9A%A9%ED%95%B4%20%EB%B0%B0%ED%8F%AC%ED%95%B4%EB%B3%B4%EA%B8%B0/"/>
    <id>http://yoursite.com/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes%EB%A5%BC%20%EC%9D%B4%EC%9A%A9%ED%95%B4%20%EB%B0%B0%ED%8F%AC%ED%95%B4%EB%B3%B4%EA%B8%B0/</id>
    <published>2020-02-26T01:19:34.291Z</published>
    <updated>2020-02-28T00:32:59.906Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>이번엔 k8s를 이용해서 node에 container 배포를 진행해 보겠습니다.<br>설치할 application 은 storm 입니다. </p><h1 id="1-Application-Image-생성"><a href="#1-Application-Image-생성" class="headerlink" title="1. Application Image 생성"></a>1. Application Image 생성</h1><h3 id="1-1-storm-Dockerfile"><a href="#1-1-storm-Dockerfile" class="headerlink" title="1.1 storm Dockerfile"></a>1.1 storm Dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:centos7</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> thinkub0219@gmail.com</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/lib/jvm/java-openjdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Packages &amp; open jdk 1.9</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum update -y; \</span></span><br><span class="line"><span class="bash">    yum install -y java-1.8.0-openjdk-devel.x86_64; \</span></span><br><span class="line"><span class="bash">    yum clean all</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /home/sor</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># source copy</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./ /home/sor</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># app start</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">6010</span> <span class="number">6020</span> <span class="number">9999</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /home/sor/startup_linux</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"./startsor.sh"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"console"</span>]</span></span><br></pre></td></tr></table></figure><h3 id="1-2-생성된-Image-저장소에-push"><a href="#1-2-생성된-Image-저장소에-push" class="headerlink" title="1.2 생성된 Image 저장소에 push"></a>1.2 생성된 Image 저장소에 push</h3><h1 id="2-Secrets-생성하기"><a href="#2-Secrets-생성하기" class="headerlink" title="2. Secrets 생성하기"></a>2. Secrets 생성하기</h1><p>private repository 를 사용하는경우 image를 pull받기 위해서는 인증 절차가 필요합니다. 그외 사용자 암호, oAuth 토큰 및 ssh키와 같은 민감한 정보를 저장하고 관리해주는 기능으로 k8s Secrets를 사용합니다. 이번 실습에서는 Docker Hub Secrets 를 생성해보도록 하겠습니다.</p><h3 id="2-1-Docker-Hub-Private-Registry-로그인"><a href="#2-1-Docker-Hub-Private-Registry-로그인" class="headerlink" title="2.1 Docker Hub Private Registry 로그인"></a>2.1 Docker Hub Private Registry 로그인</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br></pre></td></tr></table></figure><h3 id="2-2-인증-token-정보-확인"><a href="#2-2-인증-token-정보-확인" class="headerlink" title="2.2 인증 token 정보 확인"></a>2.2 인증 token 정보 확인</h3><ul><li>login을 하게되면 <code>~/.docker/config.json</code> 파일이 생성됩니다. 파일 내용을 확인해봅니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.docker/config.json</span><br></pre></td></tr></table></figure><img src="/img/2020/02/26/32.png" alt=""></li></ul><h3 id="2-3-인증-토큰을-사용하여-Secret-생성하기"><a href="#2-3-인증-토큰을-사용하여-Secret-생성하기" class="headerlink" title="2.3 인증 토큰을 사용하여 Secret 생성하기"></a>2.3 인증 토큰을 사용하여 Secret 생성하기</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret docker-registry &lt;name&gt; --docker-server=DOCKER_REGISTRY_SERVER --docker-username=DOCKER_USER --docker-password=DOCKER_PASSWORD --docker-email=DOCKER_EMAIL --namespace=&lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/33.png" alt=""></p><h1 id="3-yaml-파일을-이용한-배포"><a href="#3-yaml-파일을-이용한-배포" class="headerlink" title="3. yaml 파일을 이용한 배포"></a>3. yaml 파일을 이용한 배포</h1><h3 id="3-1-storm배포를-위한-yaml-파일-작성"><a href="#3-1-storm배포를-위한-yaml-파일-작성" class="headerlink" title="3.1 storm배포를 위한 yaml 파일 작성"></a>3.1 storm배포를 위한 yaml 파일 작성</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">storm-dp</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">storm</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">storm</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">storm</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">storm</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">storm</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">'thinkub/storm:10.32.0.3'</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">imagePullSecrets:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">docker-hub</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">storm-pod</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">storm</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">storm</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">'thinkub/storm:10.32.0.3'</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">  <span class="attr">nodeName:</span> <span class="string">node-1</span></span><br><span class="line">  <span class="attr">imagePullSecrets:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">docker-hub</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">storm-svc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">defalut</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">storm</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-9999-9999</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">9999</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9999</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30000</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-6010-6010</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6010</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">6010</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30001</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-6020-6020</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6020</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">6020</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30002</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">storm</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">loadBalancer:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-2-생성된-yaml파일로-배포-해보기"><a href="#3-2-생성된-yaml파일로-배포-해보기" class="headerlink" title="3.2 생성된 yaml파일로 배포 해보기"></a>3.2 생성된 yaml파일로 배포 해보기</h3><ul><li>아래 명령어로 yaml 파일을 통한 배포를 진행합니다.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f &lt;yaml file&gt;</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/26/34.png" alt=""></p><h3 id="3-3-App-접속-확인"><a href="#3-3-App-접속-확인" class="headerlink" title="3.3 App 접속 확인"></a>3.3 App 접속 확인</h3><ul><li>service를 조회하면 app의 접근포트인 <code>9999</code> 포트가 <code>30000</code> 으로 포트포워딩 된것을 확인 할 수 있습니다.</li><li>해당 서버의 ip / port를 이용해 정상적으로 접속되는 것을 확인 할 수 있습니다.</li></ul><p><img src="/img/2020/02/26/35.png" alt=""></p><h1 id="4-UI-를-이용한-배포"><a href="#4-UI-를-이용한-배포" class="headerlink" title="4. UI 를 이용한 배포"></a>4. UI 를 이용한 배포</h1><h3 id="4-1-우측위-버튼을-클릭합니다"><a href="#4-1-우측위-버튼을-클릭합니다" class="headerlink" title="4.1 우측위 + 버튼을 클릭합니다."></a>4.1 우측위 <code>+</code> 버튼을 클릭합니다.</h3><p><img src="/img/2020/02/26/36.png" alt=""></p><h3 id="4-2-Create-from-form-를-클릭해서-UI-배포를-진행합니다"><a href="#4-2-Create-from-form-를-클릭해서-UI-배포를-진행합니다" class="headerlink" title="4.2 Create from form 를 클릭해서 UI 배포를 진행합니다."></a>4.2 <code>Create from form</code> 를 클릭해서 UI 배포를 진행합니다.</h3><ul><li>Create from input 은 yaml 파일 형식을 직접 작성해서 배포하는 방식입니다.</li><li>Create from file 은 yaml을 upload 해서 배포하는 방식입니다.<br><img src="/img/2020/02/26/37.png" alt=""></li></ul><h3 id="4-3-App의-기본정보를-입력합니다"><a href="#4-3-App의-기본정보를-입력합니다" class="headerlink" title="4.3 App의 기본정보를 입력합니다."></a>4.3 App의 기본정보를 입력합니다.</h3><ul><li>App Name 에 배포되는 application 명칭을 작성합니다.</li><li>Container Image 에 사용하려는 Image 명칭을 작성합니다.</li><li>Number of pods 에는 생성하려는 pod의 갯수를 작성합니다.<br><img src="/img/2020/02/26/38.png" alt=""></li></ul><h3 id="4-4-Service-정보를-입력합니다"><a href="#4-4-Service-정보를-입력합니다" class="headerlink" title="4.4 Service 정보를 입력합니다."></a>4.4 Service 정보를 입력합니다.</h3><ul><li>Service 는 <code>NONE</code> <code>Internal</code> <code>External</code> 이 있습니다. 이번 실습에서는 외부에 오픈되는 App이기 때문에 External을 선택합니다.</li><li>Port 에는 application에서 사용하는 Port중 외부에 오픈되어야 하는 Port를 연결해 줍니다.<br><img src="/img/2020/02/26/39.png" alt=""></li></ul><h3 id="4-5-advance-option을-작성합니다"><a href="#4-5-advance-option을-작성합니다" class="headerlink" title="4.5 advance option을 작성합니다."></a>4.5 advance option을 작성합니다.</h3><ul><li>Show advanced option을 클릭합니다.</li><li>Description 에는 배포되는 application 의 세부 정보를 작성합니다.</li><li>Image Pull Secret는 private repository를 사용하는경우 미리 설정한 secret을 선택해서 Image pull 받을때 인증을 하게됩니다. 미리 생성한 <code>docker-hub</code> 를 선택합니다.<br><img src="/img/2020/02/26/40.png" alt=""></li></ul><h3 id="4-6-Deploy-를-클릭해서-배포를-시작합니다"><a href="#4-6-Deploy-를-클릭해서-배포를-시작합니다" class="headerlink" title="4.6 Deploy 를 클릭해서 배포를 시작합니다."></a>4.6 <code>Deploy</code> 를 클릭해서 배포를 시작합니다.</h3><p><img src="/img/2020/02/26/41.png" alt=""></p><h3 id="4-7-배포완료가-되면-초록색-으로-정상적으로-배포되었다는것을-확인-할-수-있습니다"><a href="#4-7-배포완료가-되면-초록색-으로-정상적으로-배포되었다는것을-확인-할-수-있습니다" class="headerlink" title="4.7 배포완료가 되면 초록색 으로 정상적으로 배포되었다는것을 확인 할 수 있습니다."></a>4.7 배포완료가 되면 <code>초록색</code> 으로 정상적으로 배포되었다는것을 확인 할 수 있습니다.</h3><p><img src="/img/2020/02/26/42.png" alt=""></p><h3 id="4-8-Application-접속"><a href="#4-8-Application-접속" class="headerlink" title="4.8 Application 접속"></a>4.8 Application 접속</h3><p><img src="/img/2020/02/26/43.png" alt=""></p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://kubernetes.io/ko/docs/concepts/" target="_blank" rel="noopener">https://kubernetes.io/ko/docs/concepts/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Container Orchestration - 5. kubernetes ui</title>
    <link href="http://yoursite.com/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/"/>
    <id>http://yoursite.com/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/</id>
    <published>2020-02-26T01:12:29.115Z</published>
    <updated>2020-02-28T00:32:58.889Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="대시보드-UI"><a href="#대시보드-UI" class="headerlink" title="대시보드 UI"></a>대시보드 UI</h1><p>대시보드는 웹 기반 쿠버네티스 유저 인터페이스입니다. 대시보드를 통해 컨테이너화 된 애플리케이션을 쿠버네티스 클러스터에 배포할 수 있고, 컨테이너화 된 애플리케이션을 트러블슈팅 할 수 있으며, 클러스터 리소스들을 관리할 수 있습니다. </p><p><img src="/img/2020/02/26/22.png" alt=""></p><h2 id="1-설치"><a href="#1-설치" class="headerlink" title="1. 설치"></a>1. 설치</h2><p>대시보드 UI는 기본으로 설치되지 않습니다. 설치하려면 다음 커맨드를 이용하면 됩니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/23.png" alt=""></p><h2 id="2-설치확인"><a href="#2-설치확인" class="headerlink" title="2. 설치확인"></a>2. 설치확인</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/24.png" alt=""></p><h2 id="3-접속"><a href="#3-접속" class="headerlink" title="3. 접속"></a>3. 접속</h2><p>접속 방법은 총 3가지 입니다. </p><ul><li>Proxy를 이용하기</li><li>NodePort 이용하기</li><li>API Server 이용하기</li></ul><p><strong>여기서는 API Server를 이용해서 진행할 예정입니다.</strong></p><h3 id="3-1-API-Server-이용하기"><a href="#3-1-API-Server-이용하기" class="headerlink" title="3.1 API Server 이용하기"></a>3.1 API Server 이용하기</h3><ol><li>kube-apiserver 접근하기 위한 인증서 생성</li><li>클라이언트 브라우저에 인증서 적용하기</li></ol><ul><li><p>kube-apiserver 접근하기 위한 인증서 생성</p><ul><li>인증서 생성하기<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'client-certificate-data'</span> ~/.kube/config | head -n 1 | awk <span class="string">'&#123;print $2&#125;'</span> | base64 -d &gt;&gt; kubecfg.crt</span><br><span class="line">grep <span class="string">'client-key-data'</span> ~/.kube/config | head -n 1 | awk <span class="string">'&#123;print $2&#125;'</span> | base64 -d &gt;&gt; kubecfg.key</span><br></pre></td></tr></table></figure></li><li>다음으로 생성한 키를 기반으로 p12 인증서 파일을 생성합니다. (<code>password는 기억해둬야 합니다.</code>)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="built_in">export</span> -clcerts -inkey kubecfg.key -<span class="keyword">in</span> kubecfg.crt -out kubecfg.p12 -name <span class="string">"kubernetes-admin"</span></span><br></pre></td></tr></table></figure><img src="/img/2020/02/26/25.png" alt=""></li></ul></li><li><p>클라이언트 브라우저에 인증서 적용하기</p><ul><li><p>생성된 인증서 클라이언트로 Download </p></li><li><p>생성된 <code>kubecfg.p12</code> 파일과 <code>/etc/kubernetes/pki/ca.crt</code> 인증서를 사용하려는 PC에 다운받습니다.</p></li><li><p>다운로드한 인증서를 클라이언트에 적용합니다.</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil.exe -addstore "Root" D:\...\<span class="number">00</span>_Project\ca.crt</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/26.png" alt=""></p></li><li><p>p12 파일 적용시 아래와같은 인증서 설치 여부를 묻게되며 ‘예’를 선택하면 됩니다.</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil.exe -p [password] -user -importPFX D:\...\<span class="number">00</span>_Project\kubecfg.p12</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/27.png" alt=""></p></li></ul></li></ul><h2 id="4-접속확인"><a href="#4-접속확인" class="headerlink" title="4. 접속확인"></a>4. 접속확인</h2><p>ui dashboard 에 접속해 봅니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://[server_ip]:6443/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login</span><br></pre></td></tr></table></figure><ul><li><p>접근시 다음과 같이 인증서 적용 여부를 확인하게 됩니다.<br><img src="/img/2020/02/26/28.png" alt=""></p></li><li><p>dashboard 접속<br><img src="/img/2020/02/26/29.png" alt=""></p></li></ul><h3 id="4-1-Token-키-생성해서-인증하기"><a href="#4-1-Token-키-생성해서-인증하기" class="headerlink" title="4.1 Token 키 생성해서 인증하기"></a>4.1 Token 키 생성해서 인증하기</h3><ul><li><p>service 계정 생성</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl create -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kube-system</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><ul><li>ClusterRoleBinding<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl create -f -</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kube-system</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Token 가져오기</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/26/30.png" alt=""></p></li><li><p>Token 값을 이용해 인증하기<br><img src="/img/2020/02/26/31.png" alt=""></p></li></ul><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://kubernetes.io/ko/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank" rel="noopener">https://kubernetes.io/ko/docs/tasks/access-application-cluster/web-ui-dashboard/</a><br><a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener">https://github.com/kubernetes/dashboard</a><br><a href="https://crystalcube.co.kr/199" target="_blank" rel="noopener">https://crystalcube.co.kr/199</a><br><a href="https://waspro.tistory.com/516" target="_blank" rel="noopener">https://waspro.tistory.com/516</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Container Orchestration - 4. kubernetes install</title>
    <link href="http://yoursite.com/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/"/>
    <id>http://yoursite.com/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/</id>
    <published>2020-02-26T01:08:01.268Z</published>
    <updated>2020-02-28T00:32:57.794Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>쿠버네틱스에 대한 개념을 살펴봤습니다. 이번엔 직접 설치해서 어떻게 작동하는지 확인해 보겠습니다.</p><p>쿠버네티스 클러스터 중 가장 쉽게 접할 수 있는 건 <a href="https://kubernetes.io/ko/docs/setup/learning-environment/minikube/" target="_blank" rel="noopener">Minikube</a> 입니다. 하지만 Minikube 는 Master 하나로 이루어져 있어 부족한 점이 많습니다. 쿠버네티스의 다양한 기능을 살펴보려면 Master 노드와 Worker 노드 여러 개로 이루어진 실제 클러스터 환경을 구성할 필요가 있습니다.</p><p>쿠버네티스 클러스터를 구성하는 것이 간단한 일은 아닙니다. 그래서 개발자들이 처음 쿠버네티스 클러스터를 구성할 때 많은 어려움을 겪습니다. 하지만 쿠버네티스에서 제공하는 kubeadm이라는 툴을 이용하면 비교적 쉽게 설치할 수 있습니다.</p><p>앞써 쿠버네티스의 <a href="https://gitlab.ziny.us/ai-labs-aip/docker/wikis/2-Container-Orchestration/2.-kubernetes(k8s)#11-master-node" target="_blank" rel="noopener">클러스터 구조</a>를 확인했습니다.<br>Pod(Container)가 실행되는 Node와 Node를 제어하는 Master가 있습니다. <code>Master 는 cpu가 최소 2core 이상이어야 합니다.</code> </p><h1 id="1-준비하기"><a href="#1-준비하기" class="headerlink" title="1. 준비하기"></a>1. 준비하기</h1><p>Master 1대와 Node 2대로 구성해서 설치 해보겠습니다. (테스트는 개인 GCP 를 사용했습니다.)</p><p><img src="/img/2020/02/26/16.png" alt=""></p><h1 id="2-Install"><a href="#2-Install" class="headerlink" title="2. Install"></a>2. Install</h1><h3 id="2-1-사전작업"><a href="#2-1-사전작업" class="headerlink" title="2.1 사전작업"></a>2.1 사전작업</h3><p><code>모든 설치 과정은 root 권한으로 진행합니다.</code><br><code>master</code> <code>node-1</code> <code>node-2</code> 공통 작업입니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo su -</span><br></pre></td></tr></table></figure><ul><li><p>Swap 은 메모리가 부족하거나 절전 모드에서 디스크의 일부 공간을 메모리처럼 사용하는 기능입니다. Kubelet 이 정상 동작할 수 있도록 해당 기능을 swap 디바이스와 파일 모두 disable 합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a                                  <span class="comment"># paging 과 swap 기능을 끕니다.</span></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/vm/swappiness            <span class="comment"># 커널 속성을 변경해 swap을 disable 합니다.</span></span><br><span class="line">sed -e <span class="string">'/swap/ s/^#*/#/'</span> -i /etc/fstab      <span class="comment"># Swap을 하는 파일 시스템을 찾아 disable 합니다.</span></span><br></pre></td></tr></table></figure></li><li><p>각 노드의 통신을 원활하게 하기 위해 방화벽 기능을 해제합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure></li><li><p>SELinux(Security-Enhanced Linux)는 리눅스 보안 모듈로 액세스 권한을 제어합니다. 쿠버네티스에서는 컨테이너가 호스트의 파일시스템에 접속할 수 있도록 해당 기능을 꺼야 합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">'s/^SELINUX=enforcing$/SELINUX=permissive/'</span> /etc/selinux/config</span><br></pre></td></tr></table></figure></li><li><p>RHEL 과 CentOS 7에서 iptables 관련 이슈가 있어서 커널 매개변수를 다음과 같이 수정하고 적용합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure></li><li><p>br_netfilter 모듈이 활성화되어 있어야 합니다. modprobe br_netfilter 명령어로 해당 모듈을 명시적으로 추가하고, lsmod | grep br_netfilter 명령어로 추가 여부를 확인할 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br></pre></td></tr></table></figure></li><li><p>컨테이너 실행 환경인 도커(Docker)를 설치하고 실행합니다. 쿠버네티스는 도커 외에도 여러가지 CRI(Container Runtime Interface) 구현체를 지원하기 때문에 도커에 종속적이지 않습니다</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum install -y docker-ce</span><br><span class="line"></span><br><span class="line">systemctl start docker.service</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-k8s-설치"><a href="#2-2-k8s-설치" class="headerlink" title="2.2 k8s 설치"></a>2.2 k8s 설치</h3><ul><li><p>Kubeadm은 Kubelet 과 Kubectl 을 설치하지 않기 때문에 직접 설치해야 합니다. 리파지토리를 추가하고 설치 및 실행합니다. Kubectl 은 클러스터에게 명령을 내리기 위한 CLI 유틸입니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span><br><span class="line">exclude=kube*</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure></li><li><p>설치 시 사용할 이미지를 먼저 다운로드 합니다. <code>master</code> 에서만 진행합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull</span><br></pre></td></tr></table></figure></li><li><p>master 초기화를 진행합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init</span><br></pre></td></tr></table></figure></li><li><p>설치 완료시 다음과 같은 로그를 확인 할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 10.128.0.32:6443 --token l53w07.r3jv3r9z87dberca \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:03efcec987556feb1a7e2109e814fb4b74c5bc0ba47b20b8af8ce2c28dcd20ed</span><br></pre></td></tr></table></figure></li><li><p>해당 로그의 표시된 부분을 사용해야 하니 확인해주세요</p></li></ul><p><img src="/img/2020/02/26/17.png" alt=""></p><ul><li><p>여기서 일반 사용자가 kubectl 을 사용할 수 있도록 로그 중간에 있는 명령어를 복사해서 실행합니다</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure></li><li><p>맨 마지막 라인의 명령어는 Node를 Master에 연결하는 명령어 입니다. 해당 명령어를 복사해서 <code>node-1</code> <code>node-2</code> 에서 수행합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 10.128.0.32:6443 --token l53w07.r3jv3r9z87dberca \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:03efcec987556feb1a7e2109e814fb4b74c5bc0ba47b20b8af8ce2c28dcd20ed</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/26/18.png" alt=""></p><ul><li><p>command를 복사해놓지 않고 지워진 경우에는 다음과 같이 token을 확인 할 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token list</span><br></pre></td></tr></table></figure></li><li><p>해당 토큰은 24시간 동안만 사용할 수 있습니다. 새 토큰이 필요한 경우는 다음 명령어를 실행하면 됩니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token create</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-3-Pod-network-add-on-설치"><a href="#2-3-Pod-network-add-on-설치" class="headerlink" title="2.3 Pod network add-on 설치"></a>2.3 Pod network add-on 설치</h3><p>Pod 은 실제로 여러 노드에 걸쳐 배포되는데, Pod 끼리는 하나의 네트워크에 있는 것처럼 통신할 수 있습니다. 이를 오버레이 네트워크(Overlay Network)라고 합니다.</p><p>오버레이 네트워크를 지원하는 CNI(Container Network Interface) 플러그인을 설치해보겠습니다. CNI 에는 여러 종류가 있는데, 이번 실습에서는 Weave 를 이용합니다.</p><ul><li><p>Master 노드에서 다음과 같이 설치합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f <span class="string">"https://cloud.weave.works/k8s/net?k8s-version=<span class="variable">$(kubectl version | base64 | tr -d '\n')</span>"</span></span><br></pre></td></tr></table></figure></li><li><p>첨부파일 처런 각 node들의 상태가 <code>NotReday</code> 에서 <code>Reday</code> 로 변경된 것을 확인 할 수 있습니다.</p></li></ul><p><img src="/img/2020/02/26/19.png" alt=""></p><h1 id="3-설치-확인하기"><a href="#3-설치-확인하기" class="headerlink" title="3. 설치 확인하기"></a>3. 설치 확인하기</h1><ul><li>쿠버네티스의 구성 요소가 모두 동작하는 것을 확인할 수 있습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get componentstatuses</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/26/20.png" alt=""></p><ul><li>쿠버네티스의 구성 요소가 Pod 으로 어떤 노드에 떠있는지 확인할 수 있습니다. </li><li>etcd, API server, Scheduler, Controller Manager, DNS Server 는 master 에서 실행됩니다. </li><li>Kube proxy 와 Weave 는 각 worker 에서 실행됩니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get po -o custom-columns=POD:metadata.name,NODE:spec.nodeName --sort-by spec.nodeName -n kube-system</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/26/21.png" alt=""></p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://futurecreator.github.io/2019/02/25/kubernetes-cluster-on-google-compute-engine-for-developers/" target="_blank" rel="noopener">https://futurecreator.github.io/2019/02/25/kubernetes-cluster-on-google-compute-engine-for-developers/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Container Orchestration - 3. kubernetes(2)</title>
    <link href="http://yoursite.com/2020/02/26/Container%20Orchestration%20-%203.%20kubernetes(2)/"/>
    <id>http://yoursite.com/2020/02/26/Container%20Orchestration%20-%203.%20kubernetes(2)/</id>
    <published>2020-02-26T01:05:05.438Z</published>
    <updated>2020-02-28T00:32:56.811Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h2 id="3-Controller"><a href="#3-Controller" class="headerlink" title="3. Controller"></a>3. Controller</h2><p>컨트롤러는 객체가 원래 설정된 상태를 잘 유지할수있게 관리하는 역할을 합니다.</p><h3 id="3-1-Replication-Controller"><a href="#3-1-Replication-Controller" class="headerlink" title="3.1 Replication Controller"></a>3.1 Replication Controller</h3><p>언제든지 지정된 숫자 만큼의 Pod가 항상 클러스터 내에서 실행되고 있도록 관리합니다. 다시말하면 Pod 또는 동일종류의 Pod의 셋이 항상 가동되고 사용가능한지 확인합니다.</p><p><img src="/img/2020/02/26/9.svg" alt=""></p><h3 id="3-2-ReplicaSet"><a href="#3-2-ReplicaSet" class="headerlink" title="3.2 ReplicaSet"></a>3.2 ReplicaSet</h3><p>replicaset은 Replication Controller 다음 버전입니다. Replication Controller와 동일하게 동작하고 차이점은 집합 기반(set-based)의 셀렉터(selector)를 지원하는 것이 다릅니다. 복제 컨트롤러 같은 경우에는 셀렉터가 등호기반(equal-based)라서 라벨을 선택할때 같은지(=) 다른지(!=)만 확인합니다. 하지만 집합기반의 셀렉터는 in, notin, exists같은 연산자를 지원합니다.</p><p><img src="/img/2020/02/26/10.png" width="40%" height="40%"> <br></p><h3 id="3-3-Deployment"><a href="#3-3-Deployment" class="headerlink" title="3.3 Deployment"></a>3.3 Deployment</h3><p>Replication controller와 Replica Set의 좀더 상위 추상화 개념입니다. 가장 기본적인 배포 방법으로 ReplicaSet를 관리하면서 앱의 배포를 보다 세밀하게 관리할 수 있게 합니다. 단순히 실행시켜야할 pod의 개수를 유지 하는 것만이 아니라 배포할때 롤링업데이트가 가능한 것은 물론, 배포도중 멈췄다가 다시 배포하는것도 가능합니다. 배포후 이전 버전으로 롤백도 할 수 있습니다.</p><p><img src="/img/2020/02/26/11.svg" alt=""></p><h4 id="3-3-1-Rolling-Update"><a href="#3-3-1-Rolling-Update" class="headerlink" title="3.3.1 Rolling Update"></a>3.3.1 Rolling Update</h4><p>롤링 업데이트는 Pod 인스턴스를 점진적으로 새로운 것으로 업데이트하여 Deployment 업데이트가 <strong>서비스 중단 없이</strong> 이루어질 수 있도록 해줍니다.</p><p><img src="/img/2020/02/26/12.svg" width="60%" height="60%"> <br><br><img src="/img/2020/02/26/13.svg" width="60%" height="60%"> <br><br><img src="/img/2020/02/26/14.svg" width="60%" height="60%"> <br><br><img src="/img/2020/02/26/15.svg" width="60%" height="60%"> <br></p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://kubernetes.io/ko/docs/concepts/overview/" target="_blank" rel="noopener">https://kubernetes.io/ko/docs/concepts/overview/</a><br><a href="https://subicura.com/2019/05/19/kubernetes-basic-1.html" target="_blank" rel="noopener">https://subicura.com/2019/05/19/kubernetes-basic-1.html</a><br><a href="https://bcho.tistory.com/1256?category=731548" target="_blank" rel="noopener">https://bcho.tistory.com/1256?category=731548</a><br><a href="https://arisu1000.tistory.com/" target="_blank" rel="noopener">https://arisu1000.tistory.com/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Container Orchestration - 2. kubernetes(1)</title>
    <link href="http://yoursite.com/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/"/>
    <id>http://yoursite.com/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/</id>
    <published>2020-02-25T23:59:01.165Z</published>
    <updated>2020-02-28T00:32:55.725Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="쿠버네티스란"><a href="#쿠버네티스란" class="headerlink" title="쿠버네티스란"></a>쿠버네티스란</h1><p><img src="/img/2020/02/26/4.png" width="50%" height="50%"> <br><br><strong>Kubernetes(k8s)는 컨테이너화된 애플리케이션을 자동으로 배포, 스케일링 및 관리해주는 오픈소스 시스템입니다.</strong><br>Kubernetes란 명칭은 키잡이(helmsman)이나 파일럿을 뜻하는 그리스어로 구글에서 개발한 2014년 오픈소스화 된 프로젝트입니다.</p><p>k8s는 다른 Container Orchestration들 보다는 늦게 등장했지만 현재 사실상의 Container Orchestration의 표준이 되었습니다.<br>그 이유는 <a href="https://www.cncf.io/" target="_blank" rel="noopener">CNCF(Cloud Native Computing Foundation:클라우드 네이티브 컴퓨팅재단)</a>을 결성했기 때문이라고 말합니다.</p><p>대규모 컨테이너를 관리했던 구글 (Google은 내부 플랫폼인 <a href="https://kubernetes.io/blog/2015/04/borg-predecessor-to-kubernetes/" target="_blank" rel="noopener">Borg</a>를 통해 일주일에 20억 개 이상의 컨테이너 배포를 생성하고 있습니다.)의 노하우와 CNCF에 AWS, Oracle, MS, RedHat, IBM 등 수많은 기업의의 참여로 k8s를 Container Orchestration의 표준이 될 수 있었습니다.</p><h1 id="개념-이해"><a href="#개념-이해" class="headerlink" title="개념 이해"></a>개념 이해</h1><p>쿠버네티스에서 사용하는 개념은 크게 객체(Object)와 그걸 관리하는 컨트롤러(Controller)가 있습니다. 객체는 사용자가 쿠버네티스에 바라는 상태(desired state)를 의미하고 컨트롤러는 객체가 원래 설정된 상태를 잘 유지할수있게 관리하는 역할을 합니다.</p><p>k8s의 <a href="https://kubernetes.io/ko/docs/concepts/" target="_blank" rel="noopener">공식문서</a>는 한글도 지원이 됩니다. <strong>자세한 내용은 공식문서를 참고해주세요</strong><br>공식문서를 읽다보면 개념을 잡기는 쉽지 않습니다. (낯선 용어와 환경….) 저희는 가벼운 수준으로 살펴보기로 하겠습니다.</p><h2 id="1-클러스터-아키텍처"><a href="#1-클러스터-아키텍처" class="headerlink" title="1. 클러스터 아키텍처"></a>1. 클러스터 아키텍처</h2><h3 id="1-1-Master-Node"><a href="#1-1-Master-Node" class="headerlink" title="1.1 Master / Node"></a>1.1 Master / Node</h3><p>클러스터는 크게 Master 와 Node로 구성이 됩니다.<br><strong>클러스터 전체를 관리하는 Master가 존재하고, Container가 배포되는 Node가 존재합니다.</strong></p><ul><li>Master : 클러스터 관리를 담당합니다. 마스터는 애플리케이션을 스케줄링하거나, 애플리케이션의 항상성을 유지하거나, 애플리케이션을 스케일링하고, 새로운 변경사항을 순서대로 반영하는 일과 같은 클러스터 내 모든 활동을 조율합니다.</li><li>Node : 쿠버네티스 클러스터 내 워커 머신으로써 동작하는 VM 또는 물리적인 컴퓨터입니다. 각 노드들은 <a href="https://gitlab.ziny.us/ai-labs-aip/docker/wikis/2-Container-Orchestration/2.-kubernetes(k8s)#21-pod" target="_blank" rel="noopener">Pod</a>를 동작시키기 위해 필요한 서비스를 포함하여 마스터 컴포넌트에 의해 관리됩니다.</li></ul><p><img src="/img/2020/02/26/5.svg" alt=""></p><h2 id="2-Object"><a href="#2-Object" class="headerlink" title="2. Object"></a>2. Object</h2><p>쿠버네티스는 상태를 관리하기 위한 대상을 오브젝트로 정의합니다. 기본으로 수십 가지 오브젝트를 제공하고 새로운 오브젝트를 추가하기가 매우 쉽기 때문에 확장성이 좋습니다. 여러 오브젝트 중 주요 오브젝트는 다음과 같습니다.</p><h3 id="2-1-Pod"><a href="#2-1-Pod" class="headerlink" title="2.1 Pod"></a>2.1 Pod</h3><p>Pod 는 쿠버네티스에서 생성되고 관리될 수 있는 배포 <code>가능한 최소 컴퓨팅 단위</code>입니다.</p><ul><li><strong>한개 이상의 컨테이너를 가질 수 있습니다.</strong> 하지만 대부분 1~2개의 컨테이너를 갖게 됩니다. 이유는 <code>배포의 최소 단위</code>이기 때문에 Pod내부에 다수의 컨테이너들이 묶여있으면 scale-out이 쉽지 않거나 비효율적으로 이뤄지는 문제가 있습니다.</li><li>Pod 내부의 Container들은 Ip/Port와 볼륨등을 공유하고 서로 localhost로 통신이 가능합니다.</li><li>Pod에서 사용하는 Ip / Port는 서비스에서 사용되지 않습니다 (<code>External 접근이 되지 않음</code>) Pod는 <code>Service</code>를 통해 접근이 가능하기 때문인데 <code>Service</code>를 Pod에 연결했을때 외부 접근이 가능합니다.</li><li>Pod는 언젠가는 반드시 죽는(mortal) 오브젝트입니다. 수명이 있다는 의미로 Pod는 생성되고, 소멸된 후 부활하지 않습니다.</li></ul><p><img src="/img/2020/02/26/6.png" width="50%" height="50%"> <br></p><ul><li>Pod는 총 5개의 상태값을 가집니다.</li></ul><table><thead><tr><th>값</th><th>의미</th></tr></thead><tbody><tr><td>Pending</td><td>Pod가 쿠버네티스 시스템에 의해서 승인되었지만, Pod를 위한 하나 또는 하나 이상의 컨테이너 이미지 생성이 아직 완료되지 않았다. 여기에는 스케줄되기 이전까지의 시간 뿐만 아니라 오래 걸릴 수 있는 네트워크를 통한 이미지 다운로드 시간도 포함된다.</td></tr><tr><td>Running</td><td>Pod가 한 노드에 결합되었고, 모든 컨테이너들의 생성이 완료되었다. 적어도 하나의 컨테이너가 동작 중이거나, 시작 또는 재시작 중에 있다.</td></tr><tr><td>Succeeded</td><td>Pod에 있는 모든 컨테이너들이 성공으로 종료되었고, 재시작되지 않을 것이다.</td></tr><tr><td>Failed</td><td>Pod에 있는 모든 컨테이너들이 종료되었고, 적어도 하나 이상의 컨테이너가 실패로 종료되었다. 즉, 해당 컨테이너는 non-zero 상태로 빠져나왔거나(exited) 시스템에 의해서 종료(terminated)되었다</td></tr><tr><td>Unknown</td><td>어떤 이유에 의해서 Pod의 상태를 얻을 수 없다. 일반적으로 Pod 호스트와의 통신 오류에 의해서 발생한다.</td></tr></tbody></table><h3 id="2-2-Sevice"><a href="#2-2-Sevice" class="headerlink" title="2.2 Sevice"></a>2.2 Sevice</h3><p>pod에서 실행 중인 프로세스를 위한 신원(identity)을 제공합니다. 쿠버네티스에서 서비스는 pod의 논리적 집합과 그것들에 접근할 수 있는 정책을 정의하는 추상적 개념입니다.</p><p><code>Pod를 외부 네트워크와 연결해주고</code> 여러 개의 Pod을 바라보는 내부 로드 밸런서를 생성할 때 사용합니다. 내부 DNS에 서비스 이름을 도메인으로 등록하기 때문에 서비스 디스커버리 역할도 합니다.</p><p>서비스를 정의할때, 어떤 Pod를 서비스로 묶을 것인지를 정의하는데, 이를 라벨 셀렉터라고 합니다. 각 Pod를 생성할때 메타데이타 정보 부분에 라벨을 정의할 수 있는데 서비스는 라벨 셀렉터에서 특정 라벨을 가지고 있는 Pod만 선택하여 서비스에 묶게 됩니다.</p><p>Pod의 경우에는 동적으로 생성이 되고, 장애가 생기면 자동으로 리스타트 되면서 그 IP가 바뀌기 때문에, 로드밸런서에서 Pod의 목록을 지정할 때는 IP주소를 이용하는 것은 어렵습니다. 또한 오토 스케일링으로 인하여 Pod 가 동적으로 추가 또는 삭제되기 때문에, 이렇게 추가/삭제된 Pod 목록을 로드밸런서가 유연하게 선택해 줘야 합니다.<br>그래서 사용하는 것이 <strong>라벨(label)</strong> 과 <strong>라벨 셀렉터(label selector)</strong> 라는 개념입니다.</p><p><img src="/img/2020/02/26/7.svg" width="50%" height="50%"> <br></p><h3 id="2-3-Volume"><a href="#2-3-Volume" class="headerlink" title="2.3 Volume"></a>2.3 Volume</h3><p>저장소와 관련된 오브젝트입니다. 호스트 디렉토리를 그대로 사용할 수도 있고 EBS 같은 스토리지를 동적으로 생성하여 사용할 수도 있습니다.<br>사실상 인기 있는 대부분의 저장 방식을 <a href="https://kubernetes.io/docs/concepts/storage/#types-of-volumes" target="_blank" rel="noopener">지원</a>합니다.<br>Pod가 기동할때 디폴트로 컨테이너마다 로컬 디스크를 생성해서 기동되는데, 이 로컬 디스크의 경우에는 영구적이지 못합니다.<br>컨테이너가 리스타트 되거나 새로 배포될때 마다 로컬 디스크는 Pod 설정에 따라서 새롭게 정의되서 배포되기 때문에, 디스크에 기록된 내용이 유실됩니다.<br>데이타 베이스와 같이 영구적으로 파일을 저장해야 하는 경우에는 컨테이너 리스타트에 상관 없이 파일을 영속적으로 저장해야 하기때문에 Volume을 별도로 셋팅해야 합니다. 이부분은 Docker Volume와 비슷한 개념입니다.</p><p><img src="/img/2020/02/26/8.png" width="50%" height="50%"> <br></p><h3 id="2-4-NameSpace"><a href="#2-4-NameSpace" class="headerlink" title="2.4 NameSpace"></a>2.4 NameSpace</h3><p>네임스페이스는 한 쿠버네티스 클러스터내의 논리적인 분리단위입니다. Pod, Service 등은 네임스페이스 별로 생성이나 관리가 될 수 있고, 사용자의 권한 역시 이 네임스페이스 별로 나눠서 부여할 수 있습니다.<br>네임스페이스는 복수의 팀이나, 프로젝트에 걸쳐서 많은 사용자가 있는 환경에서 사용하도록 만들어졌습니다. 사용자가 거의 없거나, 수 십명 정도가 되는 경우에는, 네임스페이스를 고려할 필요가 없습니다.</p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://kubernetes.io/ko/docs/concepts/overview/" target="_blank" rel="noopener">https://kubernetes.io/ko/docs/concepts/overview/</a><br><a href="https://subicura.com/2019/05/19/kubernetes-basic-1.html" target="_blank" rel="noopener">https://subicura.com/2019/05/19/kubernetes-basic-1.html</a><br><a href="https://bcho.tistory.com/1256?category=731548" target="_blank" rel="noopener">https://bcho.tistory.com/1256?category=731548</a><br><a href="https://arisu1000.tistory.com/" target="_blank" rel="noopener">https://arisu1000.tistory.com/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Container Orchestration - 1. Container Orchestration</title>
    <link href="http://yoursite.com/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/"/>
    <id>http://yoursite.com/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/</id>
    <published>2020-02-25T23:49:25.844Z</published>
    <updated>2020-02-28T00:32:54.494Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>지금까지 Docker에 대해 가볍게 알아봤습니다.<br>Docker는 결국 Container를 사용하기 위한 기술입니다.<br>Cloud Server 혹은 물리서버에 Container를 통한 격리된 Application 환경 구축을 하다보면 Container를 관리해야 하는 관리 Point가 발생합니다. </p><p><strong>Container Orchestration</strong> 이란 Container들을 관리하는 것을 말합니다.</p><h1 id="Container-Orchestration-이-하는일"><a href="#Container-Orchestration-이-하는일" class="headerlink" title="Container Orchestration 이 하는일"></a>Container Orchestration 이 하는일</h1><ul><li>컨테이너형 애플리케이션의 배포</li><li>컨테이너 그룹에 대한 로드밸런싱</li><li>스케일링/오토스케일링</li><li>컨테이너 장애 복구</li><li>컨테이너 그룹간 격리/연결</li><li>외부로 서비스 노출</li><li>서비스 디스커버리</li><li>로그 수집 집중화/자동화</li><li>모니터링 집중화/자동화</li></ul><h1 id="Container-Orchestration-Tool"><a href="#Container-Orchestration-Tool" class="headerlink" title="Container Orchestration Tool"></a>Container Orchestration Tool</h1><p>컨테이너 오케스트레이션 툴로 가장 많이 사용되는건 아래와 같습니다.</p><ul><li>Docker Swarm</li><li>Kubernetes (줄여서 k8s)</li><li>Apache MESOS</li></ul><p><img src="/img/2020/02/26/1.png" alt="image01"></p><h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2><p><a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener">https://docs.docker.com/engine/swarm/</a><br>Docker Swarm은 최초 Docker와 별개로 개발되었으나 Docker 1.12버전부터 Docker Swarm모드로 Docker에 포함되었습니다<br>Swarm은 컨테이너 자체의 능력을 넘어서서 컨테이너화 된 응용 프로그램의 확장, 네트워킹, 보안 유지 및 유지 관리를위한 많은 도구를 제공합니다.</p><h2 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><p><a href="https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/" target="_blank" rel="noopener">https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/</a><br>쿠버네티스는 구글에서 개발한 2014년 오픈소스화 된 프로젝트입니다.<br>15년에 걸친 구글의 대규모 운영 워크로드 운영 경험과 노하우가 축적된 프로젝트로 컨테이너 중심의 관리환경을 제공합니다.</p><h2 id="Apache-MESOS"><a href="#Apache-MESOS" class="headerlink" title="Apache MESOS"></a>Apache MESOS</h2><p><a href="http://mesos.apache.org/documentation/latest/" target="_blank" rel="noopener">http://mesos.apache.org/documentation/latest/</a><br>아파치 메소스는 Twitter, Apple, Uber, Netflix 등 대형 서비스를 운영하고 있는 기업에서 다수 채택 되었으며 마이크로서비스와 빅데이터, 실시간 분석, 엘라스틱 스케일링 기능 등을 제공하고 있습니다.</p><table><thead><tr><th>Docker Swarm</th><th>Kubernetes</th><th>Apache Mesos</th></tr></thead><tbody><tr><td>- 중소형 프로젝트일 경우<br>  - 관리할 노드가 적고 많은 기능이 필요하지 않을때</td><td>- 대형 프로젝트일 경우<br> - 세밀하고 다양한 설정이 필요때</td><td>- 대형 프로젝트일 경우<br> - 검증된 오케스트레이션 툴을 찾고있때</td></tr></tbody></table><h1 id="어떤걸-선택해야-할까"><a href="#어떤걸-선택해야-할까" class="headerlink" title="어떤걸 선택해야 할까?"></a>어떤걸 선택해야 할까?</h1><p><strong><code>당연히 목적에 맞게 선택해야 합니다.</code></strong><br>단, 그래도 선택이 어려울땐 많이 사용되는걸 따라가면 됩니다. <strong>갓구글을 따라 쿠버네티스에 대해 알아보겠습니다.</strong></p><p><img src="/img/2020/02/26/2.png" alt="image02"><br><img src="/img/2020/02/26/3.png" alt=""></p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://team-platform.tistory.com/48?category=829379" target="_blank" rel="noopener">https://team-platform.tistory.com/48?category=829379</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 8. Image 저장소</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%208.%20Image%20%EC%A0%80%EC%9E%A5%EC%86%8C/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%208.%20Image%20%EC%A0%80%EC%9E%A5%EC%86%8C/</id>
    <published>2020-02-25T06:55:57.810Z</published>
    <updated>2020-02-28T00:33:08.332Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>지금까지 Docker에 대한 개념과 Container 구동방법 그리고 Image를 만드는 방법등을 살펴봤습니다.<br>이번엔 생성한 Image를 저장하고 저장된 Image를 원격에서 Pull받아서 사용할 수 있는 저장소에 대해 알아보겠습니다.</p><ol><li>Docker Hub</li><li>GitLab Container Registry</li><li>Docker Registry</li></ol><p><strong>여기서는 Docker Hub 와 GitLab Container Registry 에 대해 알아보겠습니다.</strong><br><strong>참고로 저희는 GitLab Container Registry 사용하는 방향으로 셋팅중 입니다.</strong></p><h1 id="1-Docker-Hub"><a href="#1-Docker-Hub" class="headerlink" title="1. Docker Hub"></a>1. Docker Hub</h1><p>Docker Hub는 컨테이너 이미지를위한 세계 최대의 라이브러리 및 커뮤니티입니다.<br>Docker에서 공식으로 지원하는 Repositry로 공개 Image저장소 이기도 합니다.<br>물론 약간(?) 의 비용을 지불하면 private Repository를 사용 할 수 있습니다.<br>Docker Hub에서 private Repository를 만들어 보겠습니다.</p><h3 id="1-1-Repository-생성"><a href="#1-1-Repository-생성" class="headerlink" title="1.1 Repository 생성"></a>1.1 Repository 생성</h3><ul><li>Repository 명칭을 적습니다. (broker-api로 하겠습니다.)</li><li>Repository 는 Private으로 생성하겠습니다.</li><li>Autobuild 가 지원이 됩니다. (GitHub, Bitbucket)<ul><li>GitHub과 Bitbucket를 사용하기 않기 때문에 다루지 않겠습니다.</li></ul></li></ul><p><img src="/img/2020/02/25/48.png" alt="image48"></p><p><strong>정상적으로 Repository 가 생성된 것을 확인 할 수 있습니다.</strong></p><p><img src="/img/2020/02/25/49.png" alt="image49"></p><h3 id="1-2-Image-Push"><a href="#1-2-Image-Push" class="headerlink" title="1.2 Image Push"></a>1.2 Image Push</h3><ul><li><p>생성된 Docker Hub Repository 에 Image Push를 해보겠습니다.</p><ul><li>docker login 명령어로 docker hub 계정로그인을 진행합니다.</li><li>docker pull 명령어로 생성된 이미지를 docker hub에 pull 합니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker login</span><br><span class="line">sudo docker push thinkub/broker-api:0.0.1</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/50.png" alt="image50"></li></ul></li><li><p>정상적으로 pull이 되었는지 확인해봅니다.</p></li></ul><p><img src="/img/2020/02/25/51.png" alt="image51"></p><h3 id="1-3-Image-pull"><a href="#1-3-Image-pull" class="headerlink" title="1.3 Image pull"></a>1.3 Image pull</h3><ul><li>Docker Hub Repository에 있는 Image를 pull 받아보겠습니다.</li><li><code>생성한 Repository 는 private Repository이기 때문에 docker login 이후에 pull을 받을 수 있습니다.</code></li></ul><p><img src="/img/2020/02/25/52.png" alt="image52"></p><h1 id="2-GitLab-Container-Registry"><a href="#2-GitLab-Container-Registry" class="headerlink" title="2. GitLab Container Registry"></a>2. GitLab Container Registry</h1><p>GitLab에서도 <strong>Container Registry</strong>라는 Docker Image 저장소를 제공하고 있습니다.<br>GitLab 설치시 Default 설정이 되지 않으므로 활성화를 해야 합니다.<br>관련 문서는 <a href="https://docs.gitlab.com/ce/administration/packages/container_registry.html" target="_blank" rel="noopener">이곳</a> 을 참고해주세요.</p><p><code>컨테이너 레지스트리는 기본적으로 HTTPS에서 작동합니다. HTTPS 설정을 선행한 후 진행해주세요</code><br><code>해당 문서는 gitlab이 이미 설치된 상태에서의 작업입니다.</code></p><h3 id="2-1-Registry-Container-활성화"><a href="#2-1-Registry-Container-활성화" class="headerlink" title="2.1 Registry Container 활성화"></a>2.1 Registry Container 활성화</h3><ul><li><p>/etc/gitlab/gitlab.rb 설정파일을 수정합니다.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># registry 에서 사용하는 주소로 gitlab주소에서 8929 Port를 사용하도록 설정</span></span><br><span class="line"><span class="comment"># port는 필요에의해서 변경 할 수 있음.</span></span><br><span class="line">registry_external_url <span class="string">'https://....:8929'</span></span><br><span class="line"></span><br><span class="line">gitlab_rails[<span class="string">'registry_enabled'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'registry_path'</span>] = <span class="string">"/var/opt/gitlab/gitlab-rails/shared/registry"</span></span><br><span class="line"></span><br><span class="line">registry[<span class="string">'enable'</span>] = <span class="literal">true</span></span><br><span class="line">registry[<span class="string">'registry_http_addr'</span>] = <span class="string">"localhost:5001"</span></span><br><span class="line"></span><br><span class="line">registry_nginx[<span class="string">'ssl_certificate'</span>] = <span class="string">"/etc/gitlab/ssl/Wildcard.ziny.us.crt"</span></span><br><span class="line">registry_nginx[<span class="string">'ssl_certificate_key'</span>] = <span class="string">"/etc/gitlab/ssl/Wildcard.ziny.us.key"</span></span><br></pre></td></tr></table></figure></li><li><p>gitlab 재설정</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure></li><li><p>Container Registry 접속 확인</p></li></ul><p><img src="/img/2020/02/25/53.png" alt="image53"></p><h3 id="2-2-Container-Registry-접근"><a href="#2-2-Container-Registry-접근" class="headerlink" title="2.2 Container Registry 접근"></a>2.2 Container Registry 접근</h3><p>활성화 된 Registry 에 접근해 보겠습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker login [url]:[port]</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/54.png" alt="image54"><br><code>certificate signed by unknown authority</code> 라는 오류가 발생합니다.</p><p><strong>Docker hostname을 port와 같이 사용하는경우 어떤 인증서를 사용해야할지 추측하지 않습니다.</strong><br><strong>이를 위해서 <code>/etc/docker/certs.d/{hostname:port}/</code> 폴더를 생성한 후 해당 폴더에 인증서를 저장해두어야 합니다.</strong></p><h4 id="gitlab인증서를-복사합니다"><a href="#gitlab인증서를-복사합니다" class="headerlink" title="gitlab인증서를 복사합니다."></a>gitlab인증서를 복사합니다.</h4><p><img src="/img/2020/02/25/55.png" alt="image55"></p><h4 id="gitlab-container-registry-login-해봅니다"><a href="#gitlab-container-registry-login-해봅니다" class="headerlink" title="gitlab container registry login 해봅니다."></a>gitlab container registry login 해봅니다.</h4><p><img src="/img/2020/02/25/56.png" alt="image56"></p><h3 id="2-3-Container-Registry-에-Image-push-해보기"><a href="#2-3-Container-Registry-에-Image-push-해보기" class="headerlink" title="2.3 Container Registry 에 Image push 해보기"></a>2.3 Container Registry 에 Image push 해보기</h3><ul><li>기존에 생성된 broker-api 를 push 해볼 예정입니다.</li><li>container registry project 에 맞게 tag 작업을 합니다. (tag 규칙은 아래와 같습니다)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[HOST_NAME]/[PROJECT_NAME]:[TAG] 또는</span><br><span class="line">[HOST_NAME]/[GROUP_NAME]/[PROJECT_NAME]:[TAG]</span><br><span class="line"></span><br><span class="line">ex) </span><br><span class="line">sudo docker tag broker-api [url]:[port]/ai-labs-aip/broker-api:0.0.1</span><br></pre></td></tr></table></figure></li><li>push 명령어는 다음과 같습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push [url]:[port]/ai-labs-aip/broker-api</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/25/57.png" alt="image57"></p><ul><li>정상적으로 Push 된지 확인해 봅니다.</li></ul><p><img src="/img/2020/02/25/58.png" alt="image58"></p><h3 id="2-4-Container-Registry에서-Image-Pull-받아서-Container-구동해보기"><a href="#2-4-Container-Registry에서-Image-Pull-받아서-Container-구동해보기" class="headerlink" title="2.4 Container Registry에서 Image Pull 받아서 Container 구동해보기"></a>2.4 Container Registry에서 Image Pull 받아서 Container 구동해보기</h3><ul><li>Container Registry 에서 Image 를 받아보겠습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull [url]:[port]/ai-labs-aip/broker-api:0.0.1</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/25/59.png" alt="image59"></p><ul><li>Pull 받은 Image로 Container를 구동해보겠습니다.</li></ul><p><img src="/img/2020/02/25/60.png" alt="image60"></p><ul><li>접속 확인</li></ul><p><img src="/img/2020/02/25/61.png" alt="image61"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 7. Docker Compose</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%207.%20Docker%20Compose/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%207.%20Docker%20Compose/</id>
    <published>2020-02-25T06:51:32.639Z</published>
    <updated>2020-02-28T00:33:06.406Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h1><p>Docker Compose는 <strong>다중 Container Application을 정의하고 실행하기 위한 도구</strong>입니다.<br>YAML파일을 사용하여 Application 서비스를 구성합니다.<br>예를 들어 Application 을 구동하기 위해 DB 설치를 하고, Application 구동 해야 한다면<br>DB 용 Container를 구성하고 Application용 Container를 구성해야 합니다. 이러한 구성을 Compose를 이용한다면<br>YAML로 작성된 설정파일 1개로 구성이 가능합니다.</p><p>Compose는 3단계 프로세스가 작동합니다.</p><ol><li>Dockerfile로 환경을 정의함</li><li>docker-compose.yml에서 앱을 구성하는 서비스를 정의하여 격리된 환경에서 함께 실행 될 수 있도록 함.</li><li>docker-compose up을 실행하면 Compose가 전체 앱을 시작하고 실행</li></ol><p>관련 문서는 <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">여기</a>를 참고해주세요</p><h1 id="1-Docker-Compose-설치"><a href="#1-Docker-Compose-설치" class="headerlink" title="1.Docker Compose 설치"></a>1.Docker Compose 설치</h1><p>간단하게 아래 명령어로 설치가 가능합니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.25.0/docker-compose-<span class="variable">$(uname -s)</span>-<span class="variable">$(uname -m)</span>"</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">sudo ln -s /usr/<span class="built_in">local</span>/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/44.png" alt="image44"></p><h1 id="2-Docker-Compose로-Container구동하기"><a href="#2-Docker-Compose로-Container구동하기" class="headerlink" title="2.Docker Compose로 Container구동하기"></a>2.Docker Compose로 Container구동하기</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">이번에 진행할 Sample 역시 broker-api 입니다.</span><br><span class="line">broker-api개발시 vision연동 데이터를 저장히가 위해 mongo-db 를 설치 했었습니다.</span><br><span class="line">docker-compose로 mongodb 와 broker-api 를 container구동해보도록 하겠습니다.</span><br></pre></td></tr></table></figure><h3 id="2-1-yaml-파일을-작성"><a href="#2-1-yaml-파일을-작성" class="headerlink" title="2-1. yaml 파일을 작성"></a>2-1. yaml 파일을 작성</h3><ul><li>version : docker compose 버전을 작성, 버전에 따라 지원하는 옵션이 달라집니다(관련 내용은 <a href="https://docs.docker.com/compose/compose-file/compose-versioning/" target="_blank" rel="noopener">공식문서</a> 참고)</li><li>services: container들을 정의합니다.</li><li>image: docker image를 적습니다. local에 있는 image라면 local image를 사용하고 없는 image라면 docker hub의 공식 이미지를 다운받아집니다.</li><li>restart: 서버 재시작시 container의 자동재시작 여부</li><li>port: docker run 명령의 -p 옵션</li><li>volumes: docker run 명령의 -v 옵션</li><li>container_name: 실행하는 container 명칭</li><li>environment: 환경변수<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.2"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">'broker-api2'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'18080:18080'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'/home/ces/logs:/home/thinkub0219/log'</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">"broker-api2"</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">'mongo'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_DATABASE:</span> <span class="string">vision</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_USERNAME:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_PASSWORD:</span> <span class="string">P@ssw0rd</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'./db:/home/thinkub0219/db'</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">"mongodb"</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"27017:27017"</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-docker-compose-실행"><a href="#2-2-docker-compose-실행" class="headerlink" title="2.2 docker compose 실행"></a>2.2 docker compose 실행</h3><p>docker compose를 실행하게되면 yaml파일에 정의된 내용이 실행이 됩니다.<br>container 까지 실행이 됩니다.<br><code>docker-compose.yml 파일이 있는 경로에서 실행해야 합니다.</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose up -d</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/45.png" alt="image45"></p><h1 id="3-작동확인"><a href="#3-작동확인" class="headerlink" title="3. 작동확인"></a>3. 작동확인</h1><ul><li>broker-api</li></ul><p><img src="/img/2020/02/25/46.png" alt="image46"></p><ul><li>mongodb</li></ul><p><img src="/img/2020/02/25/47.png" alt="image47"></p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a><br><a href="http://pyrasis.com/book/DockerForTheReallyImpatient" target="_blank" rel="noopener">http://pyrasis.com/book/DockerForTheReallyImpatient</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://tech.osci.kr/docker/2018/09/10/45749387/" target="_blank" rel="noopener">https://tech.osci.kr/docker/2018/09/10/45749387/</a><br><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 6. Dockerfile</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%206.%20Dockerfile/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%206.%20Dockerfile/</id>
    <published>2020-02-25T06:37:25.066Z</published>
    <updated>2020-02-28T00:33:07.275Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="Dockerfile-기본명령어"><a href="#Dockerfile-기본명령어" class="headerlink" title="Dockerfile 기본명령어"></a>Dockerfile 기본명령어</h1><blockquote><p>Dockerfile은 Docker Image를 생성하기위해 DSL언어로 구성된 파일입니다.</p></blockquote><p>Dockerfile 관련 reference 문서는 <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">이곳</a> 을 참고하시면 됩니다.</p><h3 id="From"><a href="#From" class="headerlink" title="From"></a>From</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;image&gt;:&lt;tag&gt;</span><br><span class="line">FROM centos:centos7.7.1908</span><br></pre></td></tr></table></figure><p>Base Image를 지정합니다. <code>필수값</code>으로 어떤 Image도 Base Image가 될 수 있습니다.<br>tag는 될 수 있으면 기본값(lastest) 보다 구체적인 버전을 지정하는것이 좋습니다.</p><h3 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MAINTAINER &lt;name&gt;</span><br><span class="line">MAINTAINER mhlee@saltlux.com</span><br></pre></td></tr></table></figure><p>파일 관리자의 이름 또는 Email정보를 적습니다. </p><h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPY &lt;src&gt;... &lt;dest&gt;</span><br><span class="line">COPY . /usr/src/app</span><br></pre></td></tr></table></figure><p>파일이나 디렉토리를 이미지로 복사합니다.<br>일반적으로 소스를 복사하는 데 사용합니다.<br><code>target</code> 디렉토리가 없다면 자동으로 생성합니다.</p><h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ADD &lt;src&gt;... &lt;dest&gt;</span><br><span class="line">ADD . /usr/src/app</span><br></pre></td></tr></table></figure><p>COPY명령어와 매우 유사하나 몇가지 추가 기능이 있습니다.<br>src에 파일 대신 URL을 입력할 수 있고 src에 압축 파일을 입력하는 경우 자동으로 압축을 해제하면서 복사됩니다.</p><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN &lt;command&gt;</span><br><span class="line">RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</span><br><span class="line">RUN bundle install</span><br></pre></td></tr></table></figure><p>가장 많이 사용하는 구문입니다. 명령어를 그대로 실행합니다.<br>내부적으로 /bin/sh -c 뒤에 명령어를 실행하는 방식입니다.</p><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</span><br><span class="line">CMD command param1 param2</span><br><span class="line">CMD bundle exec ruby app.rb</span><br></pre></td></tr></table></figure><p>도커 컨테이너가 실행되었을 때 실행되는 명령어를 정의합니다.<br>빌드할 때는 실행되지 않으며 여러 개의 CMD가 존재할 경우 가장 마지막 CMD만 실행됩니다.<br>한꺼번에 여러 개의 프로그램을 실행하고 싶은 경우에는 run.sh파일을 작성하여 데몬으로 실행하거나 supervisord나 forego와 같은 여러 개의 프로그램을 실행하는 프로그램을 사용합니다.</p><h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /path/to/workdir</span><br></pre></td></tr></table></figure><p>RUN, CMD, ADD, COPY등이 이루어질 기본 디렉토리를 설정합니다.<br>각 명령어의 현재 디렉토리는 한 줄 한 줄마다 초기화되기 때문에 RUN cd /path를 하더라도 다음 명령어에선 다시 위치가 초기화 됩니다.<br>같은 디렉토리에서 계속 작업하기 위해서 WORKDIR을 사용합니다.</p><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE &lt;port&gt; [&lt;port&gt;...]</span><br><span class="line">EXPOSE 4567</span><br></pre></td></tr></table></figure><p>도커 컨테이너가 실행되었을 때 요청을 기다리고 있는(Listen) 포트를 지정합니다. 여러개의 포트를 지정할 수 있습니다.</p><h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [&quot;/data&quot;]</span><br></pre></td></tr></table></figure><p>컨테이너 외부에 파일시스템을 마운트 할 때 사용합니다. 반드시 지정하지 않아도 마운트 할 수 있지만, 기본적으로 지정하는 것이 좋습니다.</p><h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENV &lt;key&gt; &lt;value&gt;</span><br><span class="line">ENV &lt;key&gt;=&lt;value&gt; ...</span><br><span class="line">ENV DB_URL mysql</span><br></pre></td></tr></table></figure><p>컨테이너에서 사용할 환경변수를 지정합니다. 컨테이너를 실행할 때 -e옵션을 사용하면 기존 값을 오버라이딩 하게 됩니다.</p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a><br><a href="http://pyrasis.com/book/DockerForTheReallyImpatient" target="_blank" rel="noopener">http://pyrasis.com/book/DockerForTheReallyImpatient</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://tech.osci.kr/docker/2018/09/10/45749387/" target="_blank" rel="noopener">https://tech.osci.kr/docker/2018/09/10/45749387/</a><br><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 5. Image 만들기</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%205.%20Image%20%EB%A7%8C%EB%93%A4%EA%B8%B0/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%205.%20Image%20%EB%A7%8C%EB%93%A4%EA%B8%B0/</id>
    <published>2020-02-25T06:24:39.997Z</published>
    <updated>2020-02-28T00:33:05.539Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h1><p>이번엔 Docker Image를 직접 만들어 보도록 하겠습니다.<br>Image를 만드는 방법은 2가지가 있습니다. (제가 아는 바로는)</p><ol><li><strong>베이스 이미지 (Os만 설치된 Container)를 만들어 놓고 Container에서 필요한 작업을 한 뒤 container commit으로 Image 생성</strong></li><li><strong>Dockerfile 을 이용한 Image생성</strong></li></ol><p>두 가지 케이스 다 실습해보도록 하겠습니다.<br>실습환경은 ces때 진행했던 broker-api 로 하겠습니다. </p><p><strong>설치순서</strong></p><ul><li>CentOS 설치</li><li>OpenJdk8 설치</li><li>application jar파일 다운로드</li><li>application start</li></ul><h1 id="1-Base-Image-OS-로-Container생성-후-commit-로-Image생성하기"><a href="#1-Base-Image-OS-로-Container생성-후-commit-로-Image생성하기" class="headerlink" title="1. Base Image(OS)로 Container생성 후 commit 로 Image생성하기."></a>1. Base Image(OS)로 Container생성 후 commit 로 Image생성하기.</h1><h3 id="1-1-CentOS-Image를-다운받습니다"><a href="#1-1-CentOS-Image를-다운받습니다" class="headerlink" title="1-1. CentOS Image를 다운받습니다."></a>1-1. CentOS Image를 다운받습니다.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull centos</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/31.png" alt="image31"></p><h3 id="1-2-Container-생성하기"><a href="#1-2-Container-생성하기" class="headerlink" title="1-2. Container 생성하기"></a>1-2. Container 생성하기</h3><ul><li>-p 옵션으로 application 사용하는 18080포트 연결 목적</li><li>-v 옵션으로 application jar 파일 mount 목적<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -itd \</span><br><span class="line">-p 18080:18080 \</span><br><span class="line">-v /home/thinkub0219/webapp:/home/webapp \</span><br><span class="line">--name <span class="string">"centos"</span> centos</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/25/32.png" alt="image32"></p><h3 id="1-3-Container-들어가기"><a href="#1-3-Container-들어가기" class="headerlink" title="1-3. Container 들어가기"></a>1-3. Container 들어가기</h3><ul><li>jdk 가 설치 되지 않은것을 확인 할 수 있습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="built_in">exec</span> -it centos /bin/bash</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/25/33.png" alt="image33"></p><h3 id="1-4-Container-내부에-OpenJdk8-설치하기"><a href="#1-4-Container-내부에-OpenJdk8-설치하기" class="headerlink" title="1-4. Container 내부에 OpenJdk8 설치하기"></a>1-4. Container 내부에 OpenJdk8 설치하기</h3><ul><li>jdk 가 설치 된 것을 확인 할 수 있습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum update -y; \</span><br><span class="line">yum install -y java-1.8.0-openjdk-devel.x86_64; \</span><br><span class="line">easy_install supervisor; \</span><br><span class="line">yum clean all</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/34.png" alt="image34"></li></ul><h3 id="1-5-application-jar-다운로드"><a href="#1-5-application-jar-다운로드" class="headerlink" title="1-5. application jar 다운로드"></a>1-5. application jar 다운로드</h3><ul><li>현재 gitlab 환경이 내부망으로 컴파일 된 jar 파일 upload 처리함</li><li>정상 적인 case로는 git clone으로 source code download 후 build 처리하는 것을 추천함.</li><li>아래 이미지와 같이 mount 된 volume에 jar파일 upload 하면 docker 에 mount된 경로에서 확인이 가능함.</li></ul><p><img src="/img/2020/02/25/35.png" alt="image35"></p><h3 id="1-6-application-start"><a href="#1-6-application-start" class="headerlink" title="1-6. application start"></a>1-6. application start</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -server -Dspring.profiles.active=dev -jar broker-api.jar &amp;</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/36.png" alt="image36"></p><h3 id="1-7-application-구동-확인"><a href="#1-7-application-구동-확인" class="headerlink" title="1-7. application 구동 확인"></a>1-7. application 구동 확인</h3><p>정상적으로 구동된 것을 확인 할 수 있습니다.</p><p><img src="/img/2020/02/25/37.png" alt="image37"></p><h3 id="1-8-image-생성하기"><a href="#1-8-image-생성하기" class="headerlink" title="1-8. image 생성하기"></a>1-8. image 생성하기</h3><p>정상적으로 구동된 것을 확인했으니, 해당 Container 기준으로 Image생성을 해보겠습니다.<br>새로 생성할 Image name 은 broker-api1 로 설정하겠습니다.<br>broker-api1이라는 image가 생성 된것을 확인 할 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker commit centos broker-api1</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/38.png" alt="image38"></p><h3 id="1-9-생성된-image로-container-구동하기"><a href="#1-9-생성된-image로-container-구동하기" class="headerlink" title="1-9. 생성된 image로 container 구동하기."></a>1-9. 생성된 image로 container 구동하기.</h3><ul><li>기존 생성된 container를 삭제합니다.</li><li>생성된 image를 이용해 container를 구동합니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -itd \</span><br><span class="line">-p 18080:18080 \</span><br><span class="line">-v /home/thinkub0219/webapp:/home/webapp \</span><br><span class="line">--name <span class="string">"broker-api1"</span> broker-api1</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/2020/02/25/39.png" alt="image39"></p><h3 id="1-10-application-구동확인"><a href="#1-10-application-구동확인" class="headerlink" title="1-10. application 구동확인"></a>1-10. application 구동확인</h3><ul><li><code>확인해보면 정상적으로 구동되지 않은 것을 확인 할 수 있습니다.</code></li><li>이유는 application start가 되지 않았기 때문입니다. container내부 환경요인은 정상 설치가 되었습니다.</li><li>application 구동을 진행하면 정상적으로 사이트 접근이 가능합니다.</li></ul><h1 id="2-Dockerfile-을-이용한-Image생성"><a href="#2-Dockerfile-을-이용한-Image생성" class="headerlink" title="2. Dockerfile 을 이용한 Image생성"></a>2. Dockerfile 을 이용한 Image생성</h1><p>이번엔 동일한 작업을 Dockerfile을 이용해서 Image생성을 해보겠습니다.<br>위 생성 방식은 나름 복잡(?) 하게 구성된 것에 비해 Dockerfile 생성 방식은 좀더 simple(?) 합니다.<br>Dockerfile에 대한 설명은 다음장에 설명하겠습니다.</p><h3 id="2-1-Dockerfile-작성"><a href="#2-1-Dockerfile-작성" class="headerlink" title="2-1. Dockerfile 작성"></a>2-1. Dockerfile 작성</h3><ul><li>centos 로 base image 를 지정한다.</li><li>작성자는 <a href="mailto:mhlee@saltlux.com" target="_blank" rel="noopener">mhlee@saltlux.com</a> 이다.</li><li>JAVA_HOME 환경변수를 지정한다.</li><li>openJdk를 설치한다.</li><li>source를 copy 한다 <code>(주의점은 container내부는 절대경로 지정이 가능하나 외부경로는 상대경로를 지정해줘야함)</code></li><li>port 설정을 한다</li><li>container 실행시 실행스크립트를 작성한다.<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> mhlee@saltlux.com</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/lib/jvm/java-openjdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Packages &amp; open jdk 1.9</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum update -y; \</span></span><br><span class="line"><span class="bash">    yum install -y java-1.8.0-openjdk-devel.x86_64; \</span></span><br><span class="line"><span class="bash">    easy_install supervisor; \</span></span><br><span class="line"><span class="bash">    yum clean all</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># source copy</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./webapp /home/webapp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># app start</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">18080</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> java -server -Dspring.profiles.active=dev -jar /home/webapp/broker-api.jar</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-Dockerfile-build"><a href="#2-2-Dockerfile-build" class="headerlink" title="2-2. Dockerfile build"></a>2-2. Dockerfile build</h3><p>작성한 Dockerfile을 이용해 Image생성을 해보겠습니다.<br>Dockerfile이 있는 경로에서 아래 명령어로 <code>broker-api2</code> 이라는 image를 생성합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker build -t broker-api2 .</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/40.png" alt="image40"></p><p>‘broker-api2’라는 Image 가 생성된 것을 확인 할 수 있습니다.<br><img src="/img/2020/02/25/41.png" alt="image41"></p><h3 id="2-3-생성된-image로-container-구동하기"><a href="#2-3-생성된-image로-container-구동하기" class="headerlink" title="2-3. 생성된 image로 container 구동하기."></a>2-3. 생성된 image로 container 구동하기.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -itd \</span><br><span class="line">-p 18080:18080 \</span><br><span class="line">-v /home/thinkub0219/webapp:/home/webapp \</span><br><span class="line">--name <span class="string">"broker-api2"</span> broker-api2</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/42.png" alt="image42"></p><h3 id="2-4-application-구동확인"><a href="#2-4-application-구동확인" class="headerlink" title="2-4. application 구동확인"></a>2-4. application 구동확인</h3><p>정상적으로 접근되는 것을 확인 할 수 있습니다.</p><p><img src="/img/2020/02/25/43.png" alt="image43"></p><h1 id="Dockerfile을-사용해야-하는-이유"><a href="#Dockerfile을-사용해야-하는-이유" class="headerlink" title="Dockerfile을 사용해야 하는 이유"></a>Dockerfile을 사용해야 하는 이유</h1><p>2가지 방법을 봤을때 Dockerfile을 사용하는게 좀더 simple(?) 해 보이는건 제 착각 일까요?<br>첫번째 방법으로 Image를 생성한 경우 Image가 삭제 되었을때 Image를 재생성 하는 과정이 Dockerfile에 비해<br>다소 복잡하고 step에 대한 누락이 발생 할 가능성이 있습니다.<br>거기에 반해 Dockerfile을 Git으로 관리하게 되면 Dockerfile 의 변경 History관리가 가능하고 버전 관리가 가능하고<br>Image 재생성 과정이 단순해 집니다.</p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a><br><a href="http://pyrasis.com/book/DockerForTheReallyImpatient" target="_blank" rel="noopener">http://pyrasis.com/book/DockerForTheReallyImpatient</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://tech.osci.kr/docker/2018/09/10/45749387/" target="_blank" rel="noopener">https://tech.osci.kr/docker/2018/09/10/45749387/</a><br><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 4. Docker Example</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%204.%20Docker%20Example/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%204.%20Docker%20Example/</id>
    <published>2020-02-25T06:19:53.837Z</published>
    <updated>2020-02-28T00:33:04.592Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><p><strong>Ubuntu OS위에 Docker를 이용해 CentOS Container 생성</strong></p><h3 id="1-docker-hub에서-centOS-Image를-검색해봅니다"><a href="#1-docker-hub에서-centOS-Image를-검색해봅니다" class="headerlink" title="1. docker hub에서 centOS Image를 검색해봅니다."></a>1. docker hub에서 centOS Image를 검색해봅니다.</h3><p><img src="/img/2020/02/25/26.png" alt="image26"></p><ul><li>centOS Image 다운로드 해서 사용하는 방법이 잘 설명되어있습니다. <a href="https://hub.docker.com/_/centos" target="_blank" rel="noopener">Site</a></li></ul><p><img src="/img/2020/02/25/27.png" alt="image27"></p><h3 id="2-centOS-Image-를-다운받습니다"><a href="#2-centOS-Image-를-다운받습니다" class="headerlink" title="2. centOS Image 를 다운받습니다."></a>2. centOS Image 를 다운받습니다.</h3><ul><li>centOS Docker Images 가 다운로드 된 것을 확인 할 수 있습니다.</li><li>images 목록을 확인하는 명령어는 다음과 같습니다.</li></ul><p><img src="/img/2020/02/25/28.png" alt="image28"></p><h3 id="3-centOS-Image를-이용해-Docker-Container-를-생성-실행-시킵니다"><a href="#3-centOS-Image를-이용해-Docker-Container-를-생성-실행-시킵니다" class="headerlink" title="3. centOS Image를 이용해 Docker Container 를 생성(실행) 시킵니다."></a>3. centOS Image를 이용해 Docker Container 를 생성(실행) 시킵니다.</h3><ul><li>Container 를 조회하는 명령어는 다음과 같습니다.</li></ul><p><img src="/img/2020/02/25/29.png" alt="image29"></p><h3 id="4-Ubuntu-OS에-Docker를-이용해서-CentOS-Container가-잘-설치-되어있는지-확인해보겠습니다"><a href="#4-Ubuntu-OS에-Docker를-이용해서-CentOS-Container가-잘-설치-되어있는지-확인해보겠습니다" class="headerlink" title="4. Ubuntu OS에 Docker를 이용해서 CentOS Container가 잘 설치 되어있는지 확인해보겠습니다."></a>4. Ubuntu OS에 Docker를 이용해서 CentOS Container가 잘 설치 되어있는지 확인해보겠습니다.</h3><ul><li>Container 에 접속하는 명령어는 다음과 같습니다.</li></ul><p><img src="/img/2020/02/25/30.png" alt="image30"></p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a><br><a href="http://pyrasis.com/book/DockerForTheReallyImpatient" target="_blank" rel="noopener">http://pyrasis.com/book/DockerForTheReallyImpatient</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://tech.osci.kr/docker/2018/09/10/45749387/" target="_blank" rel="noopener">https://tech.osci.kr/docker/2018/09/10/45749387/</a><br><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 3. Docker Command</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%203.%20Docker%20Command/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%203.%20Docker%20Command/</id>
    <published>2020-02-25T05:14:13.481Z</published>
    <updated>2020-02-28T00:33:03.692Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="Docker-Command"><a href="#Docker-Command" class="headerlink" title="Docker Command"></a>Docker Command</h1><p>Docker 명령어를 확인해 보겠습니다.<br>기본적으로 Docker의 명령어는 <a href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank" rel="noopener">사이트</a> 에 상세히 나와있습니다.</p><p>Docker에서 제공되는 옵션과 명령 종류를 확인해 보겠습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">thinkub0219@instance-1:~$ sudo docker</span><br><span class="line"></span><br><span class="line">Usage:  docker [OPTIONS] COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime for containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config files (default &quot;/home/thinkub0219/.docker&quot;)</span><br><span class="line">  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and default context set with</span><br><span class="line">                           &quot;docker context use&quot;)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to</span><br><span class="line">  -l, --log-level string   Set the logging level (&quot;debug&quot;|&quot;info&quot;|&quot;warn&quot;|&quot;error&quot;|&quot;fatal&quot;) (default &quot;info&quot;)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by this CA (default &quot;/home/thinkub0219/.docker/ca.pem&quot;)</span><br><span class="line">      --tlscert string     Path to TLS certificate file (default &quot;/home/thinkub0219/.docker/cert.pem&quot;)</span><br><span class="line">      --tlskey string      Path to TLS key file (default &quot;/home/thinkub0219/.docker/key.pem&quot;)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  builder     Manage builds</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers</span><br><span class="line">  context     Manage contexts</span><br><span class="line">  engine      Manage the docker engine</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach local standard input, output, and error streams to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container&apos;s changes</span><br><span class="line">  cp          Copy files/folders between a container and the local filesystem</span><br><span class="line">  create      Create a new container</span><br><span class="line">  diff        Inspect changes to files or directories on a container&apos;s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  exec        Run a command in a running container</span><br><span class="line">  export      Export a container&apos;s filesystem as a tar archive</span><br><span class="line">  history     Show the history of an image</span><br><span class="line">  images      List images</span><br><span class="line">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">  info        Display system-wide information</span><br><span class="line">  inspect     Return low-level information on Docker objects</span><br><span class="line">  kill        Kill one or more running containers</span><br><span class="line">  load        Load an image from a tar archive or STDIN</span><br><span class="line">  login       Log in to a Docker registry</span><br><span class="line">  logout      Log out from a Docker registry</span><br><span class="line">  logs        Fetch the logs of a container</span><br><span class="line">  pause       Pause all processes within one or more containers</span><br><span class="line">  port        List port mappings or a specific mapping for the container</span><br><span class="line">  ps          List containers</span><br><span class="line">  pull        Pull an image or a repository from a registry</span><br><span class="line">  push        Push an image or a repository to a registry</span><br><span class="line">  rename      Rename a container</span><br><span class="line">  restart     Restart one or more containers</span><br><span class="line">  rm          Remove one or more containers</span><br><span class="line">  rmi         Remove one or more images</span><br><span class="line">  run         Run a command in a new container</span><br><span class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">  search      Search the Docker Hub for images</span><br><span class="line">  start       Start one or more stopped containers</span><br><span class="line">  stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">  stop        Stop one or more running containers</span><br><span class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line">  top         Display the running processes of a container</span><br><span class="line">  unpause     Unpause all processes within one or more containers</span><br><span class="line">  update      Update configuration of one or more containers</span><br><span class="line">  version     Show the Docker version information</span><br><span class="line">  wait        Block until one or more containers stop, then print their exit codes</span><br><span class="line"></span><br><span class="line">Run &apos;docker COMMAND --help&apos; for more information on a command.</span><br></pre></td></tr></table></figure><h3 id="Images-검색하기-Docker-Hub"><a href="#Images-검색하기-Docker-Hub" class="headerlink" title="Images 검색하기 (Docker Hub)"></a>Images 검색하기 (Docker Hub)</h3><p>Docker는 <a href="https://hub.docker.com/" target="_blank" rel="noopener">Dockker Hub</a>라는 public repository가 구축되어있습니다.<br>유명 Linux배포판과 Open Source Project의 Image는 모두 Docker Hub에 공개되어있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker search ubuntu</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/15.png" alt="image15"></p><h3 id="Images-목록-확인하기"><a href="#Images-목록-확인하기" class="headerlink" title="Images 목록 확인하기"></a>Images 목록 확인하기</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker images</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/16.png" alt="image16"></p><h3 id="Image-다운로드하기"><a href="#Image-다운로드하기" class="headerlink" title="Image 다운로드하기"></a>Image 다운로드하기</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull [OPTION] name[:TAG|@DIGEST]</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/17.png" alt="image17"></p><h3 id="Images-삭제하기"><a href="#Images-삭제하기" class="headerlink" title="Images 삭제하기"></a>Images 삭제하기</h3><ul><li>Images로 Container가 실행되어있으면 Image는 삭제 되지 않습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker rmi [OPTION] IMAGE [IMAGE...]</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/18.png" alt="image18"></li></ul><h3 id="Image-History-보기"><a href="#Image-History-보기" class="headerlink" title="Image History 보기"></a>Image History 보기</h3><ul><li>Image생성 History 를 볼수 있습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="built_in">history</span> IMAGE</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/19.png" alt="image19"></li></ul><h3 id="Container-실행-생성"><a href="#Container-실행-생성" class="headerlink" title="Container 실행(생성)"></a>Container 실행(생성)</h3><p>Container 를 실행하는 명령은 다음과 같습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run [OPTION] IMAGE[:TAB|@DIGEST] [COMMAND] [ARG...]</span><br></pre></td></tr></table></figure><p>자주 사용하는 옵션들</p><table><thead><tr><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>-d</td><td>detached mode(background 모드)</td></tr><tr><td>-p</td><td>Host와 Container Port를 연결(port forwarding)</td></tr><tr><td>-v</td><td>Host와 Container의 Directory를 연결(mount)</td></tr><tr><td>-e</td><td>Container 내에서 사용할 환경변수 설정</td></tr><tr><td>-name</td><td>Container 이름설정</td></tr><tr><td>-rm</td><td>Container(Process) 종료시 Container 자동제거</td></tr><tr><td>-it</td><td>-i와 -t를 동시에 사용한것으로 terminal(키보드) 입력을 위한 옵션</td></tr><tr><td>-link</td><td>Conteinaer 연결</td></tr></tbody></table><h3 id="Container-목록-확인하기"><a href="#Container-목록-확인하기" class="headerlink" title="Container 목록 확인하기"></a>Container 목록 확인하기</h3><ul><li>현재 설치된 Container의 목록을 보여주는 명령어입니다.</li><li>일반적으로 <code>-a</code> 옵션을 붙여서 많이 사용합니다 (-a 옵션을 주지 않으면 종료된 Container는 보이지 않습니다.)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps -a</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/20.png" alt="image20"></li></ul><h3 id="Container-Stop-Start-Restart"><a href="#Container-Stop-Start-Restart" class="headerlink" title="Container Stop / Start / Restart"></a>Container Stop / Start / Restart</h3><ul><li>실행 중인 컨테이너를 중지하거나 시작 또는 재시작할 수 있는 명령어입니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stop [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line">sudo docker start CONTAINER</span><br><span class="line">sudo docker restart CONTAINER</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/21.png" alt="image21"></li></ul><h3 id="Container-제거"><a href="#Container-제거" class="headerlink" title="Container 제거"></a>Container 제거</h3><ul><li>Container를 제거하기 위해선 Stop 상태여야 합니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/22.png" alt="image22"></li></ul><h3 id="Container-Log-보기"><a href="#Container-Log-보기" class="headerlink" title="Container Log 보기"></a>Container Log 보기</h3><ul><li>Container가 정상적으로 실행이 되었는지 확인이 필요한 경우가 있습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker logs CONTAINER</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/23.png" alt="image23"></li><li>option을 주지 않는경우 전체 log를 출력합니다.</li><li>마지막 n줄의 log를 보는방법은 다음과 같습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker logs --tail 10 CONTAINER</span><br></pre></td></tr></table></figure></li><li>실시간 로그를 확인하는 방법은 다음과 같습니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker logs -f CONTAINER</span><br></pre></td></tr></table></figure></li></ul><h3 id="Container에-들어가기"><a href="#Container에-들어가기" class="headerlink" title="Container에 들어가기"></a>Container에 들어가기</h3><ul><li>Container를 관리하다 보면 실행중인 Container에 들어가야 하는경우가 많습니다.</li><li>Conatiner에 SSH를 설치해도 되지만 추천하지 않는다고 합니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker attach CONATINER</span><br></pre></td></tr></table></figure></li></ul><h3 id="Container-안의-명령-실행하기"><a href="#Container-안의-명령-실행하기" class="headerlink" title="Container 안의 명령 실행하기"></a>Container 안의 명령 실행하기</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="built_in">exec</span> [OPTIONS] CONTAINER COMMAND [ARG...]</span><br></pre></td></tr></table></figure><p><img src="/img/2020/02/25/24.png" alt="image24"></p><h3 id="Container-안의-파일-꺼내기-복사하기"><a href="#Container-안의-파일-꺼내기-복사하기" class="headerlink" title="Container 안의 파일 꺼내기(복사하기)"></a>Container 안의 파일 꺼내기(복사하기)</h3><ul><li>Container의 내부파일을 Host에 복사하는 기능입니다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker cp CONTAINER_NAME:PATH HOST_PATH</span><br></pre></td></tr></table></figure><img src="/img/2020/02/25/25.png" alt="image25"></li></ul><p>이 외에도 많은 기능들에 대해서는 <a href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank" rel="noopener">사이트</a>에서 확인해보면서 사용해 보면 될 것 같습니다. </p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a><br><a href="http://pyrasis.com/book/DockerForTheReallyImpatient" target="_blank" rel="noopener">http://pyrasis.com/book/DockerForTheReallyImpatient</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://tech.osci.kr/docker/2018/09/10/45749387/" target="_blank" rel="noopener">https://tech.osci.kr/docker/2018/09/10/45749387/</a><br><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 2. Docker Install</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%202.%20Docker%20Install/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%202.%20Docker%20Install/</id>
    <published>2020-02-25T05:06:27.492Z</published>
    <updated>2020-02-28T00:33:02.743Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="Docker-Install"><a href="#Docker-Install" class="headerlink" title="Docker Install"></a>Docker Install</h1><p>Docker의 설치 방법은 docker docs에 보면 os별로 상세히 나와 있습니다. <a href="https://docs.docker.com/install/" target="_blank" rel="noopener">Install</a></p><h3 id="제품종류"><a href="#제품종류" class="headerlink" title="제품종류"></a>제품종류</h3><table><thead><tr><th>Community Edition <code>(CE)</code></th><th>Enterprise Edition <code>(EE)</code></th></tr></thead><tbody><tr><td>Docker를 시작하고 컨테이너 기반 앱을 실험하려는<br> 개발자 및 소규모 팀에 이상적(무료)</td><td>업무용 응용프로그램 제작, 배송 및 실행하는<br> 엔터프라이즈 개발 및 IT팀을 위한 설계(유료)</td></tr></tbody></table><h3 id="Update-Cycle"><a href="#Update-Cycle" class="headerlink" title="Update Cycle"></a>Update Cycle</h3><p><img src="/img/2020/02/25/20200225_10.png" alt="image10"></p><p><strong>Docker CE 버전을 설치</strong></p><h3 id="Docker-Install-1"><a href="#Docker-Install-1" class="headerlink" title="Docker Install"></a>Docker Install</h3><ul><li><p>Ubuntu 18.04.3 LTS 에서 설치 진행</p></li><li><p>Docker 는 linux kernel을 사용해야 하기 때문에 root권한으로 진행되어야 합니다.</p></li><li><p><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">docker 설치 메뉴얼</a></p></li><li><p>처음 서버를 받으면 당연히 docker가 설치되어있지 않습니다.<br><img src="/img/2020/02/25/20200225_11.png" alt="image11"></p></li></ul><h3 id="1-package-update를-진행합니다"><a href="#1-package-update를-진행합니다" class="headerlink" title="1. package update를 진행합니다."></a>1. package update를 진행합니다.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><h3 id="2-필요한-package를-설치합니다"><a href="#2-필요한-package를-설치합니다" class="headerlink" title="2. 필요한 package를 설치합니다."></a>2. 필요한 package를 설치합니다.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg-agent \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure><h3 id="3-docker-의-공식-GPG-키를-추가합니다"><a href="#3-docker-의-공식-GPG-키를-추가합니다" class="headerlink" title="3. docker 의 공식 GPG 키를 추가합니다."></a>3. docker 의 공식 GPG 키를 추가합니다.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><p>GPG 키가 추가되었는지 확인한다 (<code>9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88</code>)<br><img src="/img/2020/02/25/20200225_12.png" alt="image12"></p><h3 id="4-안정적인-저장소-설정을-합니다"><a href="#4-안정적인-저장소-설정을-합니다" class="headerlink" title="4. 안정적인 저장소 설정을 합니다."></a>4. 안정적인 저장소 설정을 합니다.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable"</span></span><br></pre></td></tr></table></figure><h3 id="5-Docker-CE-설치하기"><a href="#5-Docker-CE-설치하기" class="headerlink" title="5. Docker CE 설치하기"></a>5. Docker CE 설치하기</h3><ul><li><strong>버전을 지정하지 않고 설치 또는 업데이트를 하면 항상 최신버전이 설치되므로 안정성 측면에서 적합하지 않을 수도 있습니다.</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li></ul><h3 id="6-설치확인"><a href="#6-설치확인" class="headerlink" title="6. 설치확인"></a>6. 설치확인</h3><p><img src="/img/2020/02/25/20200225_13.png" alt="image13"></p><h1 id="nvidia-docker-Install"><a href="#nvidia-docker-Install" class="headerlink" title="nvidia-docker Install"></a>nvidia-docker Install</h1><p>위 단계로 일반적인 Docker설치가 완료되었습니다. 하지만 NVIDIA의 GPU를 이용하시면서 여려 환경의 CUDA Toolkit을 이용할 경우<br>nvidia-docker라는 확장기능을 추가하면 보다 편리하게 사용할 수 있습니다.</p><p>nvidia-docker를 설치하고자 하실 경우 호스트 운영체제에 먼저 NVIDIA 드라이버가 설치되어 있어야 합니다.<br>NVIDIA의 그래픽카드 또는 GPU를 사용하지 않는 경우 이 과정을 진행하고 Docker 설치과정을 끝내실 수 있습니다.</p><p><img src="/img/2020/02/25/20200225_14.png" alt="image14"></p><h3 id="1-저장소-추가"><a href="#1-저장소-추가" class="headerlink" title="1. 저장소 추가"></a>1. 저장소 추가</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | \</span><br><span class="line">  sudo apt-key add -</span><br><span class="line"></span><br><span class="line">distribution=$(. /etc/os-release;<span class="built_in">echo</span> <span class="variable">$ID</span><span class="variable">$VERSION_ID</span>)</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/<span class="variable">$distribution</span>/nvidia-docker.list | \</span><br><span class="line">sudo tee /etc/apt/sources.list.d/nvidia-docker.list</span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><h3 id="2-nvidia-docker설치"><a href="#2-nvidia-docker설치" class="headerlink" title="2. nvidia-docker설치"></a>2. nvidia-docker설치</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y nvidia-container-toolkit</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><p>NVIDIA의 CUDA Docker 컨테이너 이미지 버전들은 아래의 페이지에 방문하시면 확인 하실 수 있습니다.<br><a href="https://hub.docker.com/r/nvidia/cuda/tags/" target="_blank" rel="noopener">https://hub.docker.com/r/nvidia/cuda/tags/</a></p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a><br><a href="http://pyrasis.com/book/DockerForTheReallyImpatient" target="_blank" rel="noopener">http://pyrasis.com/book/DockerForTheReallyImpatient</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://tech.osci.kr/docker/2018/09/10/45749387/" target="_blank" rel="noopener">https://tech.osci.kr/docker/2018/09/10/45749387/</a><br><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; title=&quot;Index&quot;&gt;&lt;/a&gt;Index&lt;/h1&gt;&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;Docker &lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://thinkub.github
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Docker - 1. Docker의 개념</title>
    <link href="http://yoursite.com/2020/02/25/Docker%20-%201.%20Docker%EC%9D%98%20%EA%B0%9C%EB%85%90/"/>
    <id>http://yoursite.com/2020/02/25/Docker%20-%201.%20Docker%EC%9D%98%20%EA%B0%9C%EB%85%90/</id>
    <published>2020-02-25T04:30:04.962Z</published>
    <updated>2020-02-28T00:33:01.843Z</updated>
    
    <content type="html"><![CDATA[<p>Docker 관련 블로그를 작성하는 중에 회사에서 공유 문서를 작성하라는 지침을 받고<br>회사 GitLab Wiki에 작성한것을 옮겨 본다.</p><h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><hr><ol><li>Docker <ol><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%201.%20Docker의%20개념/" target="_blank" rel="noopener">Docker 개념</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%202.%20Docker%20Install/" target="_blank" rel="noopener">Docker Install</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%203.%20Docker%20Command/" target="_blank" rel="noopener">Docker Command</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%204.%20Docker%20Example/" target="_blank" rel="noopener">Docker Example</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%205.%20Image%20만들기/" target="_blank" rel="noopener">Image 만들기</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%206.%20Dockerfile/" target="_blank" rel="noopener">Dockerfile</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%207.%20Docker%20Compose/" target="_blank" rel="noopener">Docker Compose</a></li><li><a href="https://thinkub.github.io/2020/02/25/Docker%20-%208.%20Image%20저장소/" target="_blank" rel="noopener">Image 저장소</a></li></ol></li></ol><hr><ol start="2"><li>Container Orchestration <ol><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%201.%20Container%20Orchestration/" target="_blank" rel="noopener">Container Orchestration 이란</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(1)/" target="_blank" rel="noopener">kubernetes(1)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%202.%20kubernetes(2)/" target="_blank" rel="noopener">kubernetes(2)</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%204.%20kubernetes%20install/" target="_blank" rel="noopener">kubernetes install</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%205.%20kubernetes%20ui/" target="_blank" rel="noopener">kubernetes ui</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%206.%20kubenetes를%20이용해%20배포해보기/" target="_blank" rel="noopener">kubernetes를 이용해 배포해보기</a></li><li><a href="https://thinkub.github.io/2020/02/26/Container%20Orchestration%20-%207.%20kubectl%20CLI/" target="_blank" rel="noopener">kubectl CLI</a></li></ol></li></ol><hr><ol start="3"><li>Provisioning <ol><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%201.%20Provisioning/" target="_blank" rel="noopener">Provisioning이란</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%202.%20Ansible/" target="_blank" rel="noopener">Ansible</a></li><li><a href="https://thinkub.github.io/2020/02/28/Provisioning%20-%203.%20Ansible을%20이용해%20kubernetes%20cluster%20생성하기/" target="_blank" rel="noopener">Ansible을 이용해 kubernetes cluster 생성하기</a></li></ol></li></ol><h1 id="What-Is-Docker"><a href="#What-Is-Docker" class="headerlink" title="What Is Docker?"></a>What Is Docker?</h1><p>Docker는 2013년 3월 Docker에서 출시한 오픈소스 컨테이너 프로젝트입니다.</p><p>Docker is an open-source engine that automates the deployment of any application as a lightweight, portable, self-sufficient container that will run virtually anywhere.</p><blockquote><p>Docker는 거의 어디에서나 실행되는 경량이면서 portable하고, 자급자족인 컨테이너 응용 프로그램의 배포를 자동화하는 오픈소스 엔진입니다.</p></blockquote><p><strong>직역을 해도 docker 어떤건지에 대해 이해하기는 쉽지 않습니다.</strong><br><img src="/img/2020/02/25/20200225_01.png" alt="image01"></p><p>Docker는 어느 플랫폼에서나 재현가능한 어플리케이션 컨테이너를 만들어주는 것을 목표합니다.<br>LXC(리눅스 컨테이너)라는 개념에서 출발해서 특정 리눅스 배포판에서 사용 가능합니다.<br>하지만 거의 대부분이 사용하는 Linux OS 입니다. Cent, Ubuntu, Debian, Fedora 등입니다.<br>가상 머신이라고 하기보다는 격리된 환경을 만들어주는 도구입니다.</p><h3 id="Docker의-특징"><a href="#Docker의-특징" class="headerlink" title="Docker의 특징"></a>Docker의 특징</h3><ul><li>유연성(Flexible): 복잡한 Application도 Container화 할 수 있습니다.</li><li>경량(Lightweight): Container는 Host Kernel을 사용하고 공유합니다.</li><li>교환가능(Interchangeable): 업데이트 및 업그레이드를 즉시 배포 할 수 있습니다.</li><li>휴대성(Portable): 로컬로 구축하고, 클라우드에 배치하고, 어디서나 실행 가능합니다.</li><li>확장성(Scalable): Container 복제본을 늘리고 자동으로 배포 할 수 있습니다.</li><li>스태킹(Stackable): 서비스를 세로 및 가로로 쌓을 수 있습니다.</li></ul><h1 id="Why-Docker"><a href="#Why-Docker" class="headerlink" title="Why Docker?"></a>Why Docker?</h1><p>그렇다면 docker를 사용해야 할 이유가 뭘까요?</p><p>서버가 물리서버에서 클라우드 서버 환경으로 바뀌면서 클릭 몇 번 만으로 서버를 만들어 낼 수 있게 되었습니다.<br>서버의 수가 증가하면서 관리하기 어려운 환경이 되면서 <strong>Immutable Infrastructure</strong>라는 패러다임이 나왔습니다.</p><h3 id="Immutable-Infrastructure"><a href="#Immutable-Infrastructure" class="headerlink" title="Immutable Infrastructure"></a>Immutable Infrastructure</h3><p>호스트 OS와 서비스 운영환경을 분리하고, <strong>한 번 설정한 운영환경은  변하지 않는다</strong></p><ul><li><strong>편리한 관리</strong>: 서비스 운영 환경을 이미지로 생성했기 때문에 이미지 자체만 관리하면 됩니다. 특히 이미지를 중앙 관리하여 체계적인 배포와 관리를 할 수 있습니다. 또한, 이미지 생성 설정도 파일로 되어 있기 때문에 버전 관리 시스템을 활용할 수 있습니다.</li><li><strong>확장</strong> : 이미지 하나로 서버를 계속 찍어낼 수 있습니다. 따라서 클라우드 플랫폼의 자동 확장(Auto Scaling) 기능과 연동하면 손쉽게 서비스를 확장할 수 있습니다.</li><li><strong>테스트</strong>: 개발자의 PC나 테스트 서버에서 이미지를 실행하기만 하면 서비스 운영 환경과 동일한 환경이 구성되기 때문에 테스트가 매우 쉽습니다.</li><li><strong>가볍다</strong> : 운영체제와 서비스 운영 환경을 분리하여 가볍고(Lightweight) 어디서든 실행 가능한(Portable) 환경을 제공합니다.</li></ul><p><strong>Immutable Infrastructure를 구현한 프로젝트가 바로 <code>Docker</code> 입니다.</strong></p><p><img src="/img/2020/02/25/20200225_02.png" alt="image02"></p><ul><li>빠른 마켓 출시</li><li>개발자의 생산성</li><li>배포속도</li><li>IT 인프라 축소</li><li>IT 운영 효율성</li><li>빠른 문제해결</li></ul><p><strong>Docker는 Image를 이용해 Container를 생성(실행)합니다.</strong><br><strong>그러기 위해선 Docker Imager, Docker Container가 무엇인지 알아야 합니다.</strong><br><strong>Image와 Container에 대한 개념을 먼저 알아보겠습니다.</strong></p><h1 id="Docker-Images"><a href="#Docker-Images" class="headerlink" title="Docker Images"></a>Docker Images</h1><p>이미지는 추상적인 개념이며, 이미지를 기반으로 생성된 컨테이너가 실행됩니다.<br>이미지는 코드, 런타임, 도서관, 환경 변수 및 구성 파일 등 응용 프로그램을 실행하는 데 필요한 모든 것을 포함하는 실행 가능한 패키지로 상태값을 가지지 않고 변하지 않습니다.<strong>(Immutable)</strong><br>이미지는 직접 제작할 수도 있고 Docker Hub 와 같은 repository 에 올라가 있는 image 를 사용목적에 맞게 다운받아서 사용할 수 있습니다.</p><p><img src="/img/2020/02/25/20200225_03.png" alt="image03"></p><p>도커 이미지는 Docker hub에 등록하거나 Docker Registry 저장소를 직접 만들어 관리할 수 있습니다. 현재 공개된 도커 이미지는 50만개가 넘고 Docker hub의 이미지 다운로드 수는 80억회에 이릅니다. 누구나 쉽게 이미지를 만들고 배포할 수 있습니다.</p><p><img src="/img/2020/02/25/20200225_04.png" alt="image04"></p><p>참고로 Docker Hub는 유료입니다. 물론 무료로 사용할 수 있지만 1개의 private repository 를 제공해 줍니다. <strong>(개인사용자기준)</strong> 기업이 사용하기 위해서는 유료정책 만 있습니다.</p><p><img src="/img/2020/02/25/20200225_05.png" alt="image05"></p><p>이미지는 Container를 실행하기 위한 모든 정보를 가지고 있기 때문에 용량이 큰 편입니다. 최초 Image를 다운받은 후 기존 Image에 파일이 하나 추가됬다고 Image를 다시 다운받는다면 매우 비효율 적이죠</p><p>Docker는 이런 문제를 Layer라는 개념을 사용해서 해결했습니다.<br>Image는 n개의 Layer로 구성되고 파일이 추가되거나 수정되면 새로운 Layer가 생성됩니다.<br>예를들어 ubuntu 가 a, b, c layer 로 이루어져 있다면 ubuntu image 베이스로 만든 nginx Image는 A, B, C 그리고 nginx가 됩니다.<br>여기에 webapp image를 nginx 기반으로 만들어 졌다면 a, b, c, nginex, source 레이어가 합쳐진 image가 됩니다.<br>이런 구성에서 webapp source를 수정한다면 source layer 만 다운받아져서 사용이 가능합니다.</p><p>이런식으로 Docker는 Image를 통째로 생성하지 않고, 바뀐 부분만 생성한 뒤 부모 이미지를 계속 참조하는 방식으로 동작합니다.</p><p><img src="/img/2020/02/25/20200225_06.png" alt="image06"></p><h1 id="Docker-Container"><a href="#Docker-Container" class="headerlink" title="Docker Container"></a>Docker Container</h1><p><img src="/img/2020/02/25/20200225_07.png" alt="image07"></p><p><strong>Docker Container 는 Docker Image를 기반으로 실행된 상태</strong> 입니다.<br>1개의 Image로 n개의 Container를 구성 할 수 있습니다.<br>운영체제로 예를 들면 Image는 실행파일이고 Container는 실행파일로 작동하는 프로세스입니다.</p><p>Container는 Image로부터 생성되지만 Container내부의 내용은 변경 가능합니다. <strong>(Mutable)</strong><br>Conatiner가 변경된다고 해서 Image에는 어떠한 영향도 작용되지 않습니다.</p><p>Docker Container는 Linux Container에서 기반된 기술입니다.<br>초기 버전에서는 Linux Container를 사용했지만 이후로 자체 개발한 Container를 개발했습니다.</p><p>Container는 가상화방식중 하나로 <strong>프로세스를 격리</strong> 해줍니다.</p><p><a href="https://youtu.be/n-JwAM6XF88" target="_blank" rel="noopener"><img src="/img/2020/02/25/20200225_08.png" alt="Video Label"></a><br>출처 : RedHat Videos</p><h3 id="Docker-Container는-가상머신인가"><a href="#Docker-Container는-가상머신인가" class="headerlink" title="Docker Container는 가상머신인가?"></a>Docker Container는 가상머신인가?</h3><p><img src="/img/2020/02/25/20200225_09.png" alt="image09"></p><p>왼쪽이 docker Container이고 오른쪽이 VM 입니다.<br>Docker를 처음 접하는 분들은 Docker를 가상머신으로 인식하시는 분들이 많습니다.<br>Docker Container 를 볼때 외부에서 볼떄는 process 로 보이고 내부에서 보면 vm 같이 보입니다.<br>Docker는 가상화의 한 방법이긴 하지만 기존 가상화 / 반가상화 방식과는 다르게 Guest OS 설치가 필요없습니다.<br>vm의 경우에 하드웨어 리소스를 사용하기 위해 하이퍼바이저 설치가 필요하고 각자 Guest OS 설치를 해야 합니다.<br>거기에 반해 Docker Container 는 Linux 커널위에서 단순히 프로세스를 격리 시키기 때문에 가볍고 빠르게 동작합니다.</p><p>이러니 저러니 해도 직접 설치해서 사용해보는것 만큼 좋은 공부는 없는것 같습니다.<br>일단 Docker를 설치해보도록 하겠습니다.</p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><blockquote><p><a href="https://www.docker.com" target="_blank" rel="noopener">https://www.docker.com</a><br><a href="http://pyrasis.com/book/DockerForTheReallyImpatient" target="_blank" rel="noopener">http://pyrasis.com/book/DockerForTheReallyImpatient</a><br><a href="https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose" target="_blank" rel="noopener">https://www.44bits.io/ko/post/almost-perfect-development-environment-with-docker-and-docker-compose</a><br><a href="https://tech.osci.kr/docker/2018/09/10/45749387/" target="_blank" rel="noopener">https://tech.osci.kr/docker/2018/09/10/45749387/</a><br><a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html" target="_blank" rel="noopener">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Docker 관련 블로그를 작성하는 중에 회사에서 공유 문서를 작성하라는 지침을 받고&lt;br&gt;회사 GitLab Wiki에 작성한것을 옮겨 본다.&lt;/p&gt;
&lt;h1 id=&quot;Index&quot;&gt;&lt;a href=&quot;#Index&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
